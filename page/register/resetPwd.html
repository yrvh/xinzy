<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="../../js/mui.min.js"></script>
    <link rel="stylesheet" href="../../css/mui.min.css">
    <title>重置密码</title>
    <script type="text/javascript">
        mui.init();
    </script>
		
		<style type="text/css">
			body {
			    margin: 0;
			    padding: 0;
			    font-size: 16px;
			    /* background-color: white; */
			}
			
			header {
			    position: relative;
			    width: 100%;
			    height: 44px;
			    box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
			    font-weight: bold;
			    text-align: center;
			    line-height: 44px;
			    background-color: white;
			}
			
			.backBox {
			    position: absolute;
			    left: 0;
			    top: 0;
			}
			
			.backBox>img {
			    margin: 12px 0 0 5px;
			    float: left;
			    /* position: absolute;
			    top: 12px;
			    left: 5px; */
			    width: 20px;
			    vertical-align: middle;
			}
			
			.backBox>span {
			    float: left;
			    vertical-align: middle;
			    line-height: 46px;
			    margin-left: 5px;
			    color: #7EB6FF;
			    font-weight: bold;
			    font-size: 16px;
			}
			
			.cont {
			    width: 100%;
			    background-color: white;
			    margin-top: 20px;
			}
			
			.tel,
			.verify {
			    position: relative;
			    width: calc(100% - 30px);
			    height: 40px;
			    margin-left: 15px;
			    line-height: 40px;
			}
			
			.tel {
			    border-bottom: 1px solid rgba(231, 231, 231, 1);
			}
			
			#tel,
			#verify {
			    position: absolute;
			    top: 0;
			    left: 80px;
			    width: 60%;
			    height: 39px;
			    outline: none;
			    border: none;
			}
			
			.getVerify {
			    position: absolute;
			    top: 0;
			    right: 0;
			    width: 100px;
			    height: 40px;
			    line-height: 40px;
			    text-align: right;
			    color: #7EB6FF;
			}
			
			.nextBtn {
			    width: 80%;
			    height: 40px;
			    background-color: #7EB6FF;
			    color: white;
			    text-align: center;
			    line-height: 40px;
			    border-radius: 4px;
			    margin-left: 10%;
			    margin-top: 40px;
			}
			
			.errorBg {
			    width: 100%;
			    height: 100vh;
			    position: absolute;
			    top: 0;
			    left: 0;
			    z-index: 999;
			    display: none;
			}
			
			.errorBg .error {
			    position: absolute;
			    padding: 10px 15px;
			    top: calc((100vh - 25px)/2);
			    left: 0;
			    width: 50%;
			    margin-left: 25%;
			    background-color: rgba(126, 182, 255, 0.7);
			    color: white;
			    font-size: 12px;
			    text-align: center;
			    line-height: 20px;
			    font-size: 15px;
			    border-radius: 3px;
			}body {
    margin: 0;
    padding: 0;
    font-size: 16px;
    /* background-color: white; */
}

header {
    position: relative;
    width: 100%;
    height: 44px;
    box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
    font-weight: bold;
    text-align: center;
    line-height: 44px;
    background-color: white;
}

.backBox {
    position: absolute;
    left: 0;
    top: 0;
}

.backBox>img {
    margin: 12px 0 0 5px;
    float: left;
    /* position: absolute;
    top: 12px;
    left: 5px; */
    width: 20px;
    vertical-align: middle;
}

.backBox>span {
    float: left;
    vertical-align: middle;
    line-height: 46px;
    margin-left: 5px;
    color: #7EB6FF;
    font-weight: bold;
    font-size: 16px;
}

.cont {
    width: 100%;
    background-color: white;
    margin-top: 20px;
}

.tel,
.verify {
    position: relative;
    width: calc(100% - 30px);
    height: 40px;
    margin-left: 15px;
    line-height: 40px;
}

.tel {
    border-bottom: 1px solid rgba(231, 231, 231, 1);
}

#tel,
#verify {
    position: absolute;
    top: 0;
    left: 80px;
    width: 60%;
    height: 39px;
    outline: none;
    border: none;
}

.getVerify {
    position: absolute;
    top: 0;
    right: 0;
    width: 100px;
    height: 40px;
    line-height: 40px;
    text-align: right;
    color: #7EB6FF;
}

.nextBtn {
    width: 80%;
    height: 40px;
    background-color: #7EB6FF;
    color: white;
    text-align: center;
    line-height: 40px;
    border-radius: 4px;
    margin-left: 10%;
    margin-top: 40px;
}

.errorBg {
    width: 100%;
    height: 100vh;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 999;
    display: none;
}

.errorBg .error {
    position: absolute;
    padding: 10px 15px;
    top: calc((100vh - 25px)/2);
    left: 0;
    width: 50%;
    margin-left: 25%;
    background-color: rgba(126, 182, 255, 0.7);
    color: white;
    font-size: 12px;
    text-align: center;
    line-height: 20px;
    font-size: 15px;
    border-radius: 3px;
}
		</style>
</head>

<body>
    <header>
        <div class="backBox">
            <img class="back" src="../../img/back.png" alt="">
            <span id="back">登录页</span>
        </div>

        <span class="title">重置密码</span>
    </header>
    <div class="cont">
        <div class="tel">
            新密码
            <input type="password" name="userNum" id="tel" placeholder="请输入新密码">
        </div>
        <div class="verify">
            确认新密码
            <input type="password" name="verify" id="verify" placeholder="请再次确认新密码">
            <!-- <span class="getVerify">获取验证码</span> -->
            <!-- <div class="getVerify">获取验证码</div> -->
        </div>
    </div>
    <div class="nextBtn">完成</div>
    <div class="errorBg">
        <div class="error">手机号不正确</div>
    </div>



</body>
<script src="../../js/jquery-3.3.1.js"></script>
<script src="../../js/layer/layer.js"></script>
<script src="../../js/urlDns.js"></script>

<script type="text/javascript">
	// 返回登录页面
	$(".backBox").click(() => {
	    location.href = "./login.html";
	});
	
	var findPwdTel = sessionStorage.getItem("findPwdTel");
	var findPwdVerify = sessionStorage.getItem("findPwdVerify");
	console.log(findPwdTel)
	console.log(findPwdVerify)
	    // 检验密码格式 8-18位字母和数字组成
	var pwdReg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,18}$/;
	
	$(".nextBtn").click(() => {
	    var pwd1 = $("#tel").val();
	    var pwd2 = $("#verify").val();
	    if (pwd1 == "") {
	        errorTips("请输入新密码");
	    } else if (!pwdReg.test(pwd1)) {
	        errorTips("密码由8-18位字母和数字组成");
	    } else if (pwd2 == "") {
	        errorTips("请确认新密码");
	    } else if (pwd1 != pwd2) {
	        errorTips("两次密码不一致");
	    } else {
	        // 等待提示
	        var postTips = layer.load(1, {
	            // 数组中第一个参数是button的透明度
	            // 第二个是背景颜色
	            shade: [0.3, "white"]
	        });
	        // 修改密码
	        var changePwdPost = $.ajax({
	            url: urlDns + "/findpassword_app",
	            type: 'post',
	            dataType: "json",
	            timeout: 120000, //2分钟超时
	            data: {
	                tel: findPwdTel,
	                password: pwd1
	            },
	            //请求成功
	            success: function(data) {
	                layer.close(postTips);
	                console.log(JSON.stringify(data));
	                if (data.result == 1) {
	                    sessionStorage.removeItem("findPwdTel");
	                    errorTips("修改成功！");
	                    setTimeout(() => {
	                        location.href = "./login.html";
	                    }, 1500);
	
	                } else if (data.result == 0) {
	                    errorTips(data.message);
	                } else {
	                    errorTips("修改失败");
	                }
	            },
	            error: function(XMLHttpRequest, textStatus, errorThrown) {
	                console.log(textStatus)
	                layer.close(postTips);
	                if (textStatus == 'timeout') {
	                    changePwdPost.abort();
	                    alert("请求超时");
	                }
	                if (textStatus == 'error') {
	                    console.log(errorThrown)
	                    changePwdPost.abort();　
	                    alert("请求错误" + errorThrown);
	
	                }
	            }
	        });
	    }
	});
	
	
	// 给用户弹出错误提示的方法
	function errorTips(info) {
	    $(".error").text(info);
	    $(".errorBg").css("display", "block");
	
	    var t = setTimeout(function() {
	        $(".errorBg").css("display", "none");
	    }, 3000);
	
	    $('.errorBg').click(() => {
	        $(".errorBg").css("display", "none");
	        clearTimeout(t);
	    });
	}
</script>


</html>