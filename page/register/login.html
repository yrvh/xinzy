<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title>登录/注册</title>
	<script src="../../js/mui.min.js"></script>
	<link rel="stylesheet" href="../../css/mui.min.css">
	<script type="text/javascript" charset="utf-8">
		mui.init();
	</script>
		
	<style>
		body {
		    margin: 0;
		    padding: 0;
		    background-color: white;
		    font-size: 14px;
		    color: #333333;
		}
		
		.logo {
		    position: relative;
		    width: 100%;
		    height: 25vh;
		    /* background-color: pink; */
		}
		
		.logo>img {
		    position: absolute;
		    width: 100%;
		    height: 58vw;
		    top: 0;
		    left: 0;
		}
		
		.z-index {
		    position: absolute;
		    left: 25px;
		    top: 45vw;
		    width: calc(100% - 50px);
		    height: 320px;
		    background-color: white;
		    box-shadow: 0 2px 10px 1px rgb(242, 242, 242);
		    z-index: 99;
		    border-radius: 4px;
		}
		
		.logintext {
		    /* position: absolute; */
		    display: flex;
		    justify-content: space-around;
		    width: 100%;
		    height: 80px;
		    /* color: white; */
		    bottom: 25px;
		}
		
		.loginBtn,
		.registerBtn {
		    display: inline-block;
		    width: 50%;
		    text-align: center;
		    font-size: 16px;
		    margin-top: 35px;
		}
		
		.registerBtn {
		    color: #cccccc;
		}
		
		.tipsBox {
		    width: 50%;
		    position: absolute;
		    top: 60px;
		    left: 0;
		}
		
		.tips {
		    width: 30px;
		    height: 3px;
		    background-color: #7EB6FF;
		    border-radius: 1px;
		    position: absolute;
		    left: calc((100% - 30px)/2);
		}
		
		.userNum,
		.pwd,
		.verify,
		.userName {
		    position: relative;
		    width: 90%;
		    height: 40px;
		    border-bottom: 1px solid rgb(235, 235, 240);
		    line-height: 40px;
		    margin-left: 5%;
		    font-size: 16px;
		}
		
		#userNum,
		#reUserNum,
		#reUserName,
		#pwd,
		#verify,
		#confirmPwd,
		#rePwd {
			position: absolute;
			padding: 0;
			top: 0;
			right: 0;
			border: none;
			outline: none;
			width: 75%;
			height: 39px;
			font-size: 16px;
		}
		
		.remember,
		.agree {
		    display: flex;
		    justify-content: space-between;
		    font-size: 12px;
		    width: 90%;
		    height: 50px;
		    margin-left: 5%;
		    line-height: 50px;
		}
		
		.remember span,
		.agree span {
		    /* position: relative; */
		    /* bottom: 2px; */
		    color: gray;
		    font-size: 14px;
		}
		
		#agree {
		    border-color: red;
		}
		
		#remPwd {
		    margin: 0;
		}
		
		#login,
		#selRegister,
		#agentRegister {
		    width: 90%;
		    height: 40px;
		    color: white;
		    border: none;
		    margin-left: 5%;
		    border-radius: 3px;
		    background-color: #7EB6FF;
		    outline: none;
		    font-size: 17px;
		}
		
		#agentRegister {
		    margin-top: 15px;
		}
		
		.clause {
		    color: #7EB6FF !important;
		}
		
		.getVerify {
		    position: absolute;
		    height: 39px;
		    border: none;
		    outline: none;
		    background-color: white;
		    font-size: 16px;
		    right: 0;
		    top: 0;
		    color: #7EB6FF;
		}
		
		#registerBox {
		    display: none;
		}
		
		#loginBox {
		    position: relative;
		    top: 0;
		    left: 0;
		}
		
		.errorBg {
		    width: 100%;
		    height: 100vh;
		    position: absolute;
		    top: 0;
		    left: 0;
		    z-index: 999;
		    display: none;
		}
		
		.errorBg .error {
		    position: absolute;
		    padding: 10px 15px;
		    top: calc((100vh - 25px)/2);
		    left: 0;
		    width: 50%;
		    margin-left: 25%;
		    background-color: rgba(126, 182, 255, 0.7);
		    color: white;
		    font-size: 12px;
		    text-align: center;
		    line-height: 20px;
		    font-size: 15px;
		    border-radius: 3px;
		}
		
		.black {
		    width: 100%;
		    height: 100vh;
		    background-color: rgba(16, 16, 16, 0.1);
		    position: fixed;
		    top: 0;
		    left: 0;
		    z-index: 9;
		    display: none;
		}
		
		.black>section {
		    position: relative;
		    width: 270px;
		    height: 144px;
		    border-radius: 13px;
		    background-color: white;
		    margin: 0 auto;
		    margin-top: calc((100vh - 144px)/2);
		}
		
		.cancel,
		.ok {
		    position: absolute;
		    bottom: 0;
		    width: 50%;
		    height: 45px;
		    text-align: center;
		    line-height: 45px;
		    border-top: 1px solid #e7e7e7;
		}
		
		.cancel {
		    left: 0;
		    color: #666666;
		}
		
		.ok {
		    right: 0;
		    color: #7EB6FF;
		    border-left: 1px solid #e7e7e7;
		}
		
		.tipCont {
		    font-size: 12px;
		    color: rgb(153, 153, 153);
		    padding: 0 35px;
		    text-align: center;
		    padding-top: 20px;
		}
		
		.threeBoxBg {
		    display: none;
		    position: fixed;
		    top: 0;
		    left: 0;
		    z-index: 100;
		    width: 100%;
		    height: 100vh;
		    background-color: rgba(16, 16, 16, 0.1);
		}
		
		.threeBox {
		    position: absolute;
		    top: calc((100vh - 450px)/2);
		    left: calc((100% - 300px)/2);
		    width: 300px;
		    height: 450px;
		    background-color: white;
		    border-radius: 4px;
		}
		
		.threeTitle {
		    position: absolute;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 50px;
		    text-align: center;
		    line-height: 50px;
		    background-color: #7EB6FF;
		    color: white;
		    font-size: 16px;
		    border-radius: 4px 4px 0 0;
		    z-index: 9;
		}
		
		.one,
		.two,
		.three,
		.cont,
		.agreeThreeBox {
		    padding: 0 12px 0 15px;
		}
		
		.agreeThreeBox {
		    position: absolute;
		    display: flex;
		    justify-content: space-between;
		    bottom: 0;
		    left: 0;
		    width: 100%;
		    height: 50px;
		}
		
		.disagreeThree,
		.agreeThree {
		    width: 48%;
		    height: 40px;
		    border-radius: 4px;
		    text-align: center;
		    font-size: 16px;
		    line-height: 40px;
		    box-sizing: border-box;
		}
		
		.disagreeThree {
		    color: #7EB6FF;
		    border: 1px solid #cccccc;
		}
		
		.agreeThree {
		    background-color: #7EB6FF;
		    color: white;
		}
		
		.one,
		.two,
		.three {
		    width: 100%;
		    height: 30px;
		    font-size: 14px;
		    line-height: 30px;
		}
		
		.scrollBox {
		    overflow: scroll;
		    padding-top: 70px;
		    width: 100%;
		    height: 390px;
		    /* background-color: pink; */
		}
		
		.cont {
		    padding-bottom: 10px;
		    font-size: 14px;
		    margin-top: 15px;
		    text-align: justify;
		}
		
		.updateAppTips {
		    /* display: block; */
		    z-index: 10000;
		}
		
		.updateApp_tipCont {
		    width: 100%;
		    height: 100px;
		    position: absolute;
		    top: 0;
		    left: 0;
		    text-align: center;
		    font-size: 17px;
		    line-height: 100px;
		}
		
		.updateBtn {
		    position: absolute;
		    bottom: 0;
		    left: 0;
		    width: 100%;
		    height: 43px;
		    border-top: 1px solid #cccccc;
		    text-align: center;
		    line-height: 43px;
		    font-size: 17px;
		    color: #7EB6FF;
		}
		
		.black3 {
		    width: 100%;
		    height: 100vh;
		    background-color: rgba(16, 16, 16, 0.1);
		    position: absolute;
		    top: 0;
		    left: 0;
		    z-index: 99999;
		    display: none;
		}
		
		.black3>section {
		    position: relative;
		    width: 270px;
		    height: 144px;
		    border-radius: 13px;
		    background-color: white;
		    margin: 0 auto;
		    margin-top: calc((100vh - 144px)/2);
		}
		
		.openTips {
		    width: 100%;
		    height: 99px;
		    text-align: center;
		    line-height: 99px;
		    font-size: 15px;
		    z-index: 99999;
		}
		
		.open,
		.close {
		    position: absolute;
		    bottom: 0;
		    width: 50%;
		    height: 45px;
		    text-align: center;
		    line-height: 45px;
		    border-top: 1px solid #e7e7e7;
		}
		
		.close {
		    left: 0;
		    color: #666666;
		}
		
		.open {
		    right: 0;
		    color: #7EB6FF;
		    border-left: 1px solid #e7e7e7;
		}
		.toEmpty {
			position: absolute;
			top: 11px;
			right: 10px;
			width: 17px;
			height: 17px;
		}
	</style>

</head>

<body>

    <div class="logo">
        <img src="../../img/indexBgImg.jpg" alt="">
    </div>

    <div class="z-index">
        <div class="logintext">
            <div class="loginBtn">登录</div>
            <div class="registerBtn">注册</div>
            <div class="tipsBox">
                <div class="tips"></div>
            </div>
        </div>
        <!-- 登录部分 -->
        <div id="loginBox">
            <div class="userNum">
                账号
                <input type="tel" maxlength="15" name="userNum" id="userNum" placeholder="请输入用户名/手机号" autofocus>
								<img class="toEmpty toEmptyUserNum" src="../../img/toEmpty.png" alt="">
            </div>
            <div class="pwd">
                密码
                <input type="password" name="pwd" id="pwd" placeholder="请输入登录密码">
								<img class="toEmpty toEmptyPwd" src="../../img/toEmpty.png" alt="">
            </div>
            <div class="remember">
                <div>
                    <input type="checkbox" name="remPwd" id="remPwd">&nbsp;&nbsp;
                    <span>记住密码</span>
                </div>
                <div class="forgetPwd"><span>忘记密码？</span></div>
            </div>
            <div>
                <button id="login">登录</button>
            </div>
        </div>

        <!-- 注册部分 -->

        <div id="registerBox">
            <div class="userName">
                用户名
                <input type="text" name="userName" id="reUserName" placeholder="请输入用户名" autofocus>
            </div>
            <div class="userNum">
                手机号码
                <input type="tel" maxlength="11" name="userNum" id="reUserNum" placeholder="请输入手机号码">
            </div>
            <div class="verify">
                验证码
                <input type="text" name="verify" id="verify" placeholder="请输入验证码">
                <!-- <span class="getVerify">获取验证码</span> -->
                <button class="getVerify">获取验证码</button>
            </div>
            <div class="pwd">
                密码
                <input type="password" name="pwd" id="rePwd" placeholder="请输入密码">
            </div>
            <div class="pwd">
                确认密码
                <input type="password" name="confirmPwd" id="confirmPwd" placeholder="请再次输入密码">
            </div>
            <div class="agree">
                <div id="agreeBox">
                    <input type="checkbox" name="agree" id="agree">&nbsp;&nbsp;
                    <span>已阅读并同意</span>
                    <span class="clause">《慧业通云服务平台条款》</span>
                </div>

            </div>
            <div>
                <button id="selRegister">注册</button>
            </div>
            <!-- <div>
            <button id="agentRegister">代理注册</button>
        </div> -->
        </div>
    </div>

    <div class="black resTip">
        <section>
            <div class="tipCont">将由商务秘书公司代理您的注册平台账号，您需要提供身份证、收款账号等信息给商务秘书公司</div>
            <section class="cancel">取消</section>
            <section class="ok">确定</section>
        </section>
    </div>
    <div class="errorBg">
        <div class="error"></div>
    </div>
    <div class="threeBoxBg">
        <div class="threeBox">
            <div class="threeTitle">授权划缴税款协议书</div>
            <div class="scrollBox">
                <!-- <div class="one">甲方：
                    <span class="oneName">哈哈哈</span>
                </div>
                <div class="two">
                    乙方：<span class="twoName">哈哈哈</span>
                </div>
                <div class="three">
                    丙方：<span class="threeName">哈哈哈</span>
                </div> -->
                <div class="cont">
                </div>
            </div>
            <div class="agreeThreeBox">
                <div class="disagreeThree">不签订</div>
                <div class="agreeThree">签订</div>
            </div>
        </div>
    </div>

    <!-- 提示更新APP的弹出框 -->
    <div class="black updateAppTips">
        <section>
            <div class="updateApp_tipCont"></div>
            <div class="updateBtn">确定</div>
        </section>
    </div>
    <div class="black3">
        <section>
            <div class="openTips">扫码注册</div>
            <div class="close">否</div>
            <div class="open">是</div>

        </section>

    </div>
</body>


<script src="../../js/jquery-3.3.1.js"></script>
<script src="../../js/layer/layer.js"></script>
<script src="../../js/urlDns.js"></script>

<script type="text/javascript">
	localStorage.removeItem("upid");
	
	$(function() {
		// 线上新版本号
		// var onlineVersion;
		// 请求最新安装包版本号
		var getVersion = $.ajax({
			url: urlDns + "/app_get_last",
			type: 'post',
			dataType: "json",
			data: {},
			// async: false,
			timeout: 120000, //2分钟超时
			//请求成功
			success: function(data) {
				console.log(JSON.stringify(data));
				console.log(data.app_version.replace(/\./g, ""))
				var onlineVersion = data.app_version;
				judge(data.app_version);
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log(textStatus)
				// layer.close(threeContractWeit);
				if (textStatus == 'timeout') {
					getVersion.abort();
					alert("请求超时");
				}
				if (textStatus == 'error') {
					console.log(errorThrown)
					getVersion.abort();
					alert("请求错误" + errorThrown);
	
				}
			}
		});
	
	
	
	})
	
	// 比较最新版本和本地版本号
	function judge(onlineVersion) {
		// 获取本地版本号
		$.getJSON("../../manifest.json", function(manifest) {
			var localVersion = manifest.version.name.replace(/\./g, "");
			console.log(localVersion)
			console.log(onlineVersion)
			// 当有新的版本，更新
			if (onlineVersion.replace(/\./g, "") > localVersion) {
				$(".updateApp_tipCont").text("更新版本到" + onlineVersion);
				$(".updateAppTips").css("display", "block");
			}
	
		});
	}
	
	// 确认更新版本
	$(".updateBtn").click(() => {
		var getVersion = $.ajax({
			url: urlDns + "/app_get_last",
			type: 'post',
			dataType: "json",
			data: {},
			async: false,
			timeout: 120000, //2分钟超时
			//请求成功
			success: function(data) {
				dowload(data.app_urls)
				$(".updateAppTips").css("display", "none");
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				console.log(textStatus)
				// layer.close(threeContractWeit);
				if (textStatus == 'timeout') {
					getVersion.abort();
					alert("请求超时");
				}
				if (textStatus == 'error') {
					console.log(errorThrown)
					getVersion.abort();
					alert("请求错误" + errorThrown);
	
				}
			}
		});
	})
	
	
	var dtask = null;
	// 下载的文件名
	var fileName = "";
	//下载文件
	function dowload(url) {
		var options = {
			method: "GET"
		};
		dtask = plus.downloader.createDownload(url, options);
		dtask.addEventListener("statechanged", function(task, status) {
			switch (task.state) {
				case 1: // 开始
					mui.toast("开始下载...")
					break;
				case 2: // 已连接到服务器
					// mui.toast("连接到服务器...")
					break;
				case 3: // 已接收到数据
					// alert(task.downloadedSize)    // 已下载文件大小
					// alert(task.totalSize)    // 文件大小
					break;
				case 4: // 下载完成
					mui.toast("下载完成！")
					console.log(task.totalSize)
					plus.io.resolveLocalFileSystemURL(task.filename, function(entry) {
						// alert(entry.toLocalURL() + "") // 显示下载的文件存储绝对地址
						console.log(entry.toLocalURL()) //绝对地址 
						// 判断文件是否存在，不存在则不安装
						var file = entry.toLocalURL()
						openNewApp(file)
					});
					// alert(task.filename) // 显示下载好的文件名称
					break;
			}
		});
		dtask.start();
	
	}
	
	// 安装新的APP
	function openNewApp(url) {
		plus.runtime.install(url, {}, function() {
			// alert("安装成功")
		}, function() {
			alert("安装失败")
		});
	
	}
	
	
	var verify = sessionStorage.getItem("verify");
	var inreg = sessionStorage.getItem("inreg");
	var checkedXzy = sessionStorage.getItem("checkedXzy");
	// 已经点击过薪自由条款，返回时保留原本填好的数据状态
	if (checkedXzy == 1) {
		$("#agree").attr("checked", "true");
		$("#loginBox").css("display", "none");
		$("#registerBox").css("display", "block");
		$(".tip").css("left", "calc(75% - 8px)");
		var tel = sessionStorage.getItem("tel");
		var pwd1 = sessionStorage.getItem("password");
		var pwd2 = sessionStorage.getItem("password2");
		var reUserName = sessionStorage.getItem("reUserName");
		var verify = sessionStorage.getItem("verify");
		$("#reUserName").val(reUserName);
		$("#reUserNum").val(tel);
		$("#verify").val(verify);
		$("#rePwd").val(pwd1);
		$("#confirmPwd").val(pwd2);
	}
	
	// 从下一页返回来时保留填写的数据和状态
	if (verify || inreg) {
		$("#loginBox").css("display", "none");
		$("#registerBox").css("display", "block");
		$(".tip").css("left", "calc(75% - 8px)");
		var tel = sessionStorage.getItem("tel");
		var pwd1 = sessionStorage.getItem("password");
		var pwd2 = sessionStorage.getItem("password2");
		var reUserName = sessionStorage.getItem("reUserName");
		// console.log(tel)
		$("#reUserName").val(reUserName);
		$("#reUserNum").val(tel);
		$("#verify").val(verify);
		$("#rePwd").val(pwd1);
		$("#confirmPwd").val(pwd2);
		$(".tipsBox").css("left", "50%");
		$(".loginBtn").css("color", "#cccccc");
		$(".registerBtn").css("color", "#333333");
	}
	
	// 切换登录或注册界面
	$(".loginBtn").click(function(e) {
		// 登录
		$("#registerBox").css("display", "none");
		$("#loginBox").css("display", "block");
		$(".tipsBox").css("left", 0);
		$(".z-index").css("height", "320px");
		$(".loginBtn").css("color", "#333333");
		$(".registerBtn").css("color", "#cccccc");
	});
	$(".registerBtn").click(function(e) {
		// 注册
		$("#loginBox").css("display", "none");
		$("#registerBox").css("display", "block");
		$(".tipsBox").css("left", "50%");
		$(".z-index").css("height", "440px");
		$(".loginBtn").css("color", "#cccccc");
		$(".registerBtn").css("color", "#333333");
		$(".black3").css("display", "block");
	});
	
	// 自行注册
	$(".close").click(() => {
		$(".black3").css("display", "none");
	});
	
	// 跳转扫码注册
	$(".open").click(() => {
		location.href = "./scan_res.html";
	});
	
	// 获取验证码
	$(".getVerify").on("click", get_code);
	// 定义一个计时器变量
	let time = 60
	
	// 获取同意条款页返回来的 time值
	time = sessionStorage.getItem("timeback") || 60
	// 获得是否是从同意条款页面返回来的
	if(sessionStorage.getItem("is_agree") == '1' && time != '60'){
		
		$(".getVerify").off("click")
		$(".getVerify").text(time + "秒");
		$(".getVerify").css("color", "gray");
		let tt = setInterval(() => {
			time = time - 1;
			$(".getVerify").text(time + "秒");
			if (time < 1) {
					clearInterval(tt);
					time = 60
					$(".getVerify").text("重新获取");
					$(".getVerify").css("color", "#7EB6FF");
					$(".getVerify").on("click", get_code);
			}
		}, 1000);
	}
	
	function get_code() {
		time = 59
		var tel = $("#reUserNum").val();
		if (tel == "") {
			errorTips("请输入手机号");
		} else {
			$(".getVerify").off("click");
			// 向后台发请求获取验证码
			$.post(urlDns + "/getMsm_app", {
				tel: tel
			}, function(data) {
				console.log(JSON.stringify(data));
				if (data.result == 0) {
					errorTips(data.message);
					$(".getVerify").text("获取验证码");
					$(".getVerify").css("color", "#7EB6FF");
					$(".getVerify").on("click", get_code);
				} else {
					// 倒计时
					$(".getVerify").text(time + "秒");
					$(".getVerify").css("color", "gray");
					var t = setInterval(() => {
						time = time - 1;
						$(".getVerify").text(time + "秒");
						if (time < 1) {
							clearInterval(t);
							$(".getVerify").text("重新获取");
							$(".getVerify").css("color", "#7EB6FF");
							$(".getVerify").on("click", get_code);
						}
					}, 1000);
				}
			});
		}
	}
	
	
	// 给用户弹出错误提示的方法
	function errorTips(info) {
		$(".error").text(info);
		$(".errorBg").css("display", "block");
		$('.errorBg').click(() => {
			$(".errorBg").css("display", "none");
		});
		setTimeout(function() {
			$(".errorBg").css("display", "none");
		}, 3000);
	}
	
	// 手机号正则
	var userNumReg = /^(13[0-9]|14[5-9]|15[012356789]|166|17[0-8]|18[0-9]|19[8-9])[0-9]{8}$/;
	// 检验密码格式 8-18位字母和数字组成
	var pwdReg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,18}$/;
	// 验证码格式
	var verReg = /^\d{6}$/;
	
	// 如果是扫码注册,个人信息完善一半,中途返回来的则 弹出注册成功
	if(sessionStorage.getItem("dl_success")==111) {
		mui.toast('扫码注册成功!',{ duration:'5000', type:'div' })
		sessionStorage.removeItem("dl_success")
	}
	
	
	// =========================  登录模块 =======================================
	// 点击登录 
	$("#login").click(loginApp);
	
	// 密码框按回车键 实现登录的功能
	$('#pwd').bind('keypress', function(event) {
	    if (event.keyCode == "13") {
	        event.preventDefault();
					loginApp()
	        //回车执行查询 $('#button').click();
	    }
	})
	
	// 定义点击登录时的 函数
	function loginApp() {
		var userNum = $("#userNum").val();
		var pwd = $("#pwd").val();
		if (userNum == "") {
			errorInfo = "请输入手机号或用户名";
			errorTips(errorInfo);
		} else if (pwd == "") {
			errorInfo = "请输入密码";
			errorTips(errorInfo);
		} else {
			// console.log(111)
			// console.log(userNum)
			// console.log(pwd);
			var index = layer.load(1, {
				// 数组中第一个参数是button的透明度
				// 第二个是背景颜色
				shade: [0.3, "white"]
			});
			// 登陆请求
			var loginPost = $.ajax({
				url: urlDns + "/user_app/login",
				type: 'post',
				dataType: "json",
				data: {
					tel: userNum,
					password: pwd
				},
				timeout: 120000, //2分钟超时
				//请求成功
				success: function(data) {
					layer.close(index);
					console.log(JSON.stringify(data));
					// console.log(data.ishave_dw);
	
					if (data.status == 100) {
						// 密码不正确
						errorTips("密码不正确");
					} else if (data.status == -1) {
						// 用户不存在
						// sessionStorage.setItem("status", data.status);
						// location.href = "audit.html";
						errorTips("用户不存在");
					} else {
						// 用户存在，通过验证
						loginBtn_click(); // 记住密码
						var telApp = data.tel;
						var passApp = data.password;
						// 存储验证随机数、验证手机号密码
						localStorage.setItem("code_app", data.code_app);
						localStorage.setItem("tel_app", data.tel);
						localStorage.setItem("pass_app", data.password);
						localStorage.setItem("userType", data.userType);
						localStorage.setItem("ishave_dw", data.ishave_dw);
	
						if (data.userType == 1) {
							// 角色是业者
							if (data.dlregid == 0) {
								// data.dlregid == 0  自行注册
	
								if (data.status == 4 || data.status == 1 || data.status == 5 || data.status == 2 || data.status == 3 ||
									data.status == 44) {
									// 4待业者确认资料
									// 1服务费待审核
									// 5待单位确认
									// 2待确认个人信息
									// 44业者退回
									// 3待完善资料
									// console.log(11111111111)
									sessionStorage.clear();
									sessionStorage.setItem("status", data.status);
									sessionStorage.setItem("userId", data.userid);
									sessionStorage.setItem("tel", userNum);
									location.href = "./audit.html";
								}
								if (data.status == 11) {
									// 服务费用不通过，跳转到修改服务费页面
									sessionStorage.setItem("editServiceFee", "1");
									location.href = "./onLineContract.html";
								}
								if (data.status == 55 || data.status == 22) {
									// 55被单位退回，重新修改个人信息
									// 22个人信息不通过，重新修改个人信息
									sessionStorage.clear();
									sessionStorage.setItem("userId", data.userid);
									sessionStorage.setItem("tel", userNum);
									sessionStorage.setItem("updateInfo", 1);
									location.href = "./freeInfo.html";
								}
								if (data.status == 0 || data.status == 8) {
									// sessionStorage.clear();
									// 审核全部完成，进入首页
									sessionStorage.setItem("userId", data.userid);
									sessionStorage.setItem("tel", userNum);
									sessionStorage.setItem("ishave_dw", data.ishave_dw);
									location.href = "../../index.html";
								}
								if (data.status == 175) {
									// sessionStorage.clear();
									// 用户需要同意三方协议,然后进入系统
									// console.log("哈哈哈哈")
									$(".threeBoxBg").css("display", "block");
									sessionStorage.setItem("userId", data.userid);
									sessionStorage.setItem("tel", userNum);
									console.log(data.status);
									var code_app = localStorage.getItem("code_app");
									// 等待提示
									var threeContractWeit = layer.load(1, {
										// 数组中第一个参数是button的透明度
										// 第二个是背景颜色
										shade: [0.3, "white"]
									});
									// 请求三方协议内容
									var threeContractPost = $.ajax({
										url: urlDns + "/user_app/yz/check_3_xieyiUI",
										type: 'post',
										dataType: "json",
										data: {
											"tel_app": telApp,
											"pass_app": passApp,
											"code_app": code_app
										},
										timeout: 120000, //2分钟超时
										//请求成功
										success: function(data) {
											console.log(JSON.stringify(data));
											layer.close(threeContractWeit);
											if (data.result == 0) {
												location.reload();
											} else {
	
												$(".cont").html(data.text);
	
											}
	
										},
										error: function(XMLHttpRequest, textStatus, errorThrown) {
											console.log(textStatus)
											layer.close(threeContractWeit);
											if (textStatus == 'timeout') {
												threeContractPost.abort();
												alert("请求超时");
												$(".threeBoxBg").css("display", "none");
											}
											if (textStatus == 'error') {
												console.log(errorThrown)
												threeContractPost.abort();
												$(".threeBoxBg").css("display", "none");
												alert("请求错误" + errorThrown);
	
											}
										}
									});
								}
	
							} else {
								// 代理注册
	
								if (data.status == 4 || data.status == 11 || data.status == 33 || data.status == 44 || data.status == 55 ||
									data.status == 66) {
									// 4待业者确认资料
									// 11待审核
									// 33 44 55 66资料完善中
									sessionStorage.clear();
									sessionStorage.setItem("status", data.status);
									sessionStorage.setItem("userId", data.userid);
									sessionStorage.setItem("tel", userNum);
									location.href = "./audit.html";
								}
								if (data.status == 175) {
									sessionStorage.clear();
									// 用户需要同意三方协议,然后进入系统
									// console.log("哈哈哈哈")
									$(".threeBoxBg").css("display", "block");
									sessionStorage.setItem("userId", data.userid);
									sessionStorage.setItem("tel", userNum);
									console.log(data.status);
									var code_app = localStorage.getItem("code_app");
									// 等待提示
									var threeContractWeit = layer.load(1, {
										// 数组中第一个参数是button的透明度
										// 第二个是背景颜色
										shade: [0.3, "white"]
									});
									// 请求三方协议内容
									var threeContractPost = $.ajax({
										url: urlDns + "/user_app/yz/check_3_xieyiUI",
										type: 'post',
										dataType: "json",
										data: {
											"tel_app": telApp,
											"pass_app": passApp,
											"code_app": code_app
										},
										timeout: 120000, //2分钟超时
										//请求成功
										success: function(data) {
											console.log(JSON.stringify(data));
											layer.close(threeContractWeit);
											if (data.result == 0) {
												location.reload();
											} else {
												$(".cont").html(data.text);
	
											}
	
										},
										error: function(XMLHttpRequest, textStatus, errorThrown) {
											console.log(textStatus)
											layer.close(threeContractWeit);
											if (textStatus == 'timeout') {
												threeContractPost.abort();
												alert("请求超时");
												$(".threeBoxBg").css("display", "none");
											}
											if (textStatus == 'error') {
												console.log(errorThrown)
												threeContractPost.abort();
												$(".threeBoxBg").css("display", "none");
												alert("请求错误" + errorThrown);
	
											}
										}
									});
								}
								if (data.status == 8) {
									sessionStorage.clear();
									// 审核全部完成，进入首页
									sessionStorage.setItem("userId", data.userid);
									sessionStorage.setItem("tel", userNum);
									location.href = "../../index.html";
								}
	
							}
						}
						if (data.userType == 11) {
							// 合作伙伴
							// console.log("合作伙伴" + data.userType);
							if (data.status == 4 || data.status == 1 || data.status == 5 || data.status == 2 || data.status == 3 || data
								.status == 44) {
								// 4待业者确认资料
								// 1服务费待审核
								// 5待单位确认
								// 2待确认个人信息
								// 44业者退回
								// 3待完善资料
								// console.log(11111111111)
								sessionStorage.clear();
								sessionStorage.setItem("status", data.status);
								sessionStorage.setItem("userId", data.userid);
								sessionStorage.setItem("tel", userNum);
								location.href = "./audit.html";
							}
	
							// ===============================================
							if (data.status == 11) {
								// 服务费用不通过，跳转到修改服务费页面
								sessionStorage.setItem("editServiceFee", "1");
								location.href = "./onLineContract.html";
							}
	
							if (data.status == 55 || data.status == 22) {
								// 55被单位退回，重新修改个人信息
								// 22个人信息不通过，重新修改个人信息
								sessionStorage.clear();
								sessionStorage.setItem("userId", data.userid);
								sessionStorage.setItem("tel", userNum);
								sessionStorage.setItem("updateInfo", 1);
								location.href = "./freeInfo.html";
							}
	
							// ==============================================================
	
							if (data.status == 0 || data.status == 8) {
								// sessionStorage.clear();
								// 审核全部完成，进入首页
								sessionStorage.setItem("userId", data.userid);
								sessionStorage.setItem("tel", userNum);
								sessionStorage.setItem("ishave_dw", data.ishave_dw);
								location.href = "../../cooperation/page/index.html";
							}
	
							// ==============================================================
							if (data.status == 175) {
								// sessionStorage.clear();
								// 用户需要同意三方协议,然后进入系统
								// console.log("哈哈哈哈")
								$(".threeBoxBg").css("display", "block");
								sessionStorage.setItem("userId", data.userid);
								sessionStorage.setItem("tel", userNum);
								// console.log(data.status);
								var code_app = localStorage.getItem("code_app");
								// 等待提示
								var threeContractWeit = layer.load(1, {
									// 数组中第一个参数是button的透明度
									// 第二个是背景颜色
									shade: [0.3, "white"]
								});
								// 请求三方协议内容
								var threeContractPost = $.ajax({
									url: urlDns + "/user_app/yz/check_3_xieyiUI",
									type: 'post',
									dataType: "json",
									data: {
										"tel_app": telApp,
										"pass_app": passApp,
										"code_app": code_app
									},
									timeout: 120000, //2分钟超时
									//请求成功
									success: function(data) {
										// console.log(JSON.stringify(data));
										layer.close(threeContractWeit);
										if (data.result == 0) {
											location.reload();
										} else {
	
											$(".cont").html(data.text);
	
										}
	
									},
									error: function(XMLHttpRequest, textStatus, errorThrown) {
										console.log(textStatus)
										layer.close(threeContractWeit);
										if (textStatus == 'timeout') {
											threeContractPost.abort();
											alert("请求超时");
											$(".threeBoxBg").css("display", "none");
										}
										if (textStatus == 'error') {
											console.log(errorThrown)
											threeContractPost.abort();
											$(".threeBoxBg").css("display", "none");
											alert("请求错误" + errorThrown);
	
										}
									}
								});
							}
	
							// =================================================================
						}
						if (data.userType == 4) {
							// 角色是秘书公司
	
							if (data.poststatus == 1) {
								// 风控主管
								location.href = "../../check_manager/page/index.html";
							}
							if (data.poststatus == 2) {
								// 业务员
	
								if (data.status == 222) {
									// 业务员停用状态
								}
	
								if (data.status == 888) {
									// 业务员启用状态
								}
							}
							if(data.poststatus == 4) {
								// 公司法人
								location.href = "../../manager/page/index.html"
							}
						}
	
					}
	
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					layer.close(index);
					if (textStatus === 'timeout') {
						loginPost.abort();
						alert("请求超时");
					}
					if (textStatus == 'error') {
						loginPost.abort();
						alert("请求错误" + errorThrown);
					}
				}
			})
		}
		// location.href = "../../index.html";
	}
	
	// 不签订 方协议
	$(".disagreeThree").click(() => {
		var tel_app = localStorage.getItem("tel_app");
		var pass_app = localStorage.getItem("pass_app");
		var code_app = localStorage.getItem("code_app");
		var userType = localStorage.getItem("userType");
		var index = layer.load(1, {
			// 数组中第一个参数是button的透明度
			// 第二个是背景颜色
			shade: [0.3, "white"]
		});
		var agreeContractPost = $.ajax({
			url: urlDns + "/user_app/yz/uncheck_3_xieyi",
			type: 'post',
			dataType: "json",
			data: {
				"tel_app": tel_app,
				"pass_app": pass_app,
				"code_app": code_app
			},
			timeout: 120000, //2分钟超时
			//请求成功
			success: function(data) {
				console.log(JSON.stringify(data));
				layer.close(index);
				if (data.result == 0) {
					location.reload();
				} else {
					// 合作伙伴
					if (userType == 11) {
						// 审核全部完成，进入首页
						location.href = "../../cooperation/page/index.html";
					}
	
					// 业者
					if (userType == 1) {
						location.href = "../../index.html";
					}
				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.close(index);
				if (textStatus == 'timeout') {
					agreeContractPost.abort();
					alert("请求超时");
				}
				if (textStatus == 'error') {
					agreeContractPost.abort();
					alert("请求错误" + errorThrown);
				}
			}
		});
	
	});
	
	// 签订 方协议
	$(".agreeThree").click(() => {
		var tel_app = localStorage.getItem("tel_app");
		var pass_app = localStorage.getItem("pass_app");
		var code_app = localStorage.getItem("code_app");
		var userType = localStorage.getItem("userType");
		var ishave_dw = localStorage.getItem("ishave_dw");
		console.log("用户类型" + userType)
		var index = layer.load(1, {
			// 数组中第一个参数是button的透明度
			// 第二个是背景颜色
			shade: [0.3, "white"]
		});
		var agreeContractPost = $.ajax({
			url: urlDns + "/user_app/yz/check_3_xieyi",
			type: 'post',
			dataType: "json",
			data: {
				"tel_app": tel_app,
				"pass_app": pass_app,
				"code_app": code_app
			},
			timeout: 120000, //2分钟超时
			//请求成功
			success: function(data) {
				// console.log("签订成功了login")
				// console.log(JSON.stringify(data));
				layer.close(index);
				if (data.result == 0) {
					location.reload();
				} else {
					// 合作伙伴
					if (userType == 11) {
						// 审核全部完成，进入首页
						location.href = "../../cooperation/page/index.html";
					}
	
					// 业者
					if (userType == 1) {
						location.href = "../../index.html";
					}
	
				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.close(index);
				if (textStatus == 'timeout') {
					agreeContractPost.abort();
					alert("请求超时");
				}
				if (textStatus == 'error') {
					agreeContractPost.abort();
					alert("请求错误" + errorThrown);
				}
			}
		});
	});
	
	// 从本地提取密码
	$(function() {
		var strName = localStorage.getItem('keyName');
		var strPass = localStorage.getItem('keyPass');
		if (strName!=null) {
			$('#userNum').val(strName);
			$('#pwd').val(strPass);
			$("#remPwd").attr("checked", "true");
		}
	});
	
	// 记住密码
	function loginBtn_click() {
		var strName = $('#userNum').val();
		var strPass = $('#pwd').val();
		localStorage.setItem('keyName', strName);
		if ($('#remPwd').is(':checked')) {
			localStorage.setItem('keyPass', strPass);
		} else {
			localStorage.removeItem('keyPass');
		}
	}
	
	// 自行注册按钮
	$("#selRegister").click(function() {
		// 提示给用户的信息
		var errorInfo = "";
		// 用户名
		var reUserName = $("#reUserName").val();
		// 手机号
		var reUserNum = $("#reUserNum").val();
		// 密码
		var pwd1 = $("#rePwd").val();
		// 确认密码
		var pwd2 = $("#confirmPwd").val();
		// 验证码
		var verify = $("#verify").val();
		// 勾选同意条款的按钮
		// $("#agree").attr("checked", "true")
		var agree = document.getElementById("agree").checked;
		// console.log($("#agree").prop("checked"));
	
		// 判断用户数据的错误类型
		if (reUserNum == "") {
			errorInfo = "请输入手机号";
			errorTips(errorInfo);
		} else if (!userNumReg.test(reUserNum)) {
			errorInfo = "手机号不正确";
			errorTips(errorInfo);
		} else if (verify == "") {
			errorInfo = "请输入验证码";
			errorTips(errorInfo);
		} else if (pwd1 == "") {
			errorInfo = "请输入密码";
			errorTips(errorInfo);
		} else if (!pwdReg.test(pwd1)) {
			errorInfo = "密码由8-18位字母和数字组成";
			errorTips(errorInfo);
		} else if (pwd2 == "") {
			errorInfo = "请确认密码";
			errorTips(errorInfo);
		} else if (pwd1 != pwd2) {
			errorInfo = "两次密码不一致";
			errorTips(errorInfo);
		} else if (!agree) {
			errorInfo = "请阅读并同意条款";
			errorTips(errorInfo);
		} else {
			var index = layer.load(1, {
				// 数组中第一个参数是button的透明度
				// 第二个是背景颜色
				shade: [0.3, "white"]
			});
	
			// 访问服务器先判断用户是否已经存在
			var hasUserPost = $.ajax({
				url: urlDns + "/user_app/isExits",
				type: 'post',
				dataType: "json",
				data: {
					tel: reUserNum,
					username: reUserName,
					code: verify
				},
				timeout: 120000, //2分钟超时
				//请求成功
				success: function(data) {
					layer.close(index);
					console.log(JSON.stringify(data))
					if (data.status == 1) {
						localStorage.setItem('reUserName', reUserName);
						localStorage.setItem('tel', reUserNum);
						localStorage.setItem('password', pwd1);
						localStorage.setItem('password2', pwd2);
						localStorage.setItem('verify', verify);
						// 告知freeInfo页面是新用户注册还是用户信息被退回修改的
						localStorage.setItem('isUpdate', 1);
						location.href = "./chooseIdentity.html";
					}
					if (data.status == 0) {
						console.log("手机号已存在")
						errorTips("手机号已存在");
					}
					if (data.status == -1) {
						console.log("用户名已存在")
						errorTips("用户名已存在");
					}
					if (data.status == -2) {
						console.log("手机号已存在")
						errorTips("手机号已存在");
					}
					if (data.status == -3) {
						console.log("验证码错误")
						errorTips("验证码错误");
					}
	
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					layer.close(index);
					if (textStatus == 'timeout') {
						hasUserPost.abort();
						alert("请求超时");
						console.log("请求超时")
					}
					if (textStatus == 'error') {
						hasUserPost.abort();
						console.log("请求错误")
						alert("请求错误" + errorThrown);
					}
				}
			});
		}
	
	
	});
	
	
	//同意条款
	$("#agree").click(() => {
		// console.log($("#agree").prop("checked"))
		// 用户名
		var reUserName = $("#reUserName").val();
		// 手机号
		var reUserNum = $("#reUserNum").val();
		// 密码
		var pwd1 = $("#rePwd").val();
		// 确认密码
		var pwd2 = $("#confirmPwd").val();
		// 验证码
		var verify = $("#verify").val();
	
		sessionStorage.setItem('reUserName', reUserName);
		sessionStorage.setItem('tel', reUserNum);
		sessionStorage.setItem('password', pwd1);
		sessionStorage.setItem('password2', pwd2);
		sessionStorage.setItem('verify', verify);
		sessionStorage.setItem('checkedXzy', 1);
	
		// 同意的时候打开条款页面
		if ($("#agree").prop("checked") == true) {
			sessionStorage.setItem("timeto",time)
			location.href = "./xzyClause.html";
		}
	});
	$(".clause").click(() => {
		sessionStorage.setItem("timeto",time)
		location.href = "./xzyClause.html";
	});
	
	
	$(".ok").click(() => {
		// 用户名
		var reUserName = $("#reUserName").val();
		// 手机号
		var reUserNum = $("#reUserNum").val();
		// 密码
		var pwd1 = $("#rePwd").val();
		// 确认密码
		var pwd2 = $("#confirmPwd").val();
		// 验证码
		var verify = $("#verify").val();
	
		sessionStorage.setItem('reUserName', reUserName);
		sessionStorage.setItem('tel', reUserNum);
		sessionStorage.setItem('password', pwd1);
		sessionStorage.setItem('password2', pwd2);
		sessionStorage.setItem('verify', verify);
		sessionStorage.setItem('isUpdate', 1);
		location.href = "./businessCom.html";
	});
	$(".cancel").click(() => {
		$(".resTip").css("display", "none");
	});
	
	// 忘记密码
	$(".forgetPwd").click(() => {
		location.href = "./findPwd.html";
	});
	
	// 点击叉号  清空登录的输入框账号
	$(".toEmptyUserNum").click(() => {
		$("#userNum").val('')
	})
	$(".toEmptyPwd").click(() => {
		$("#pwd").val('')
	})
</script>

</html>