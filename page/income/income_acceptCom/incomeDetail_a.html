<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<script src="../../../js/mui.min.js"></script>
	<link rel="stylesheet" href="../../../css/mui.min.css">
	<script src="../../../js/mescroll.min.js"></script>
	<link rel="stylesheet" href="../../../css/mescroll.min.css">
	<title>有业者--收入--列表页</title>
	
	<style type="text/css">
		body { margin: 0; padding: 0; font-size: 16px; color: #333333; position: relative; }
		
		header { position: fixed;
			top: 0; left: 0; text-align: center; width: 100%;
			height: 44px; line-height: 44px; background-color: white;
			box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
			font-weight: bold; font-size: 16px; z-index: 99; }
		
		.back { width: 20px; height: 20px; position: absolute; top: 12px; left: 5px; color: #7EB6FF; }		
		
		.the-place { width: 100%; height: 44px; margin-bottom: 20px;}
		
		.com-status { width: 100%; line-height: 44px; background-color: #fff; margin: 20px 0; padding: 0 15px;}
		
		ul {margin: 0; list-style: none; padding: 0 15px; background-color: #fff;}
				
		li { border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; width: 100%; height: 46px; margin-bottom: 2px; line-height: 46px; box-sizing: border-box; }
				
		li>div { display: flex; align-items: center; justify-content: space-between;}
		
		li img { width: 25px; height: 25px; }

		li>div>span { color: rgb(123, 123, 123); }
		
		ul>li:last-of-type {border: none !important;}
		.fwstyle { color: #0062CC; font-weight: 600;}
		
		.pay-amount-li { font-weight: 700; color: #0062CC; }
		.ul-title{padding-left: 14px; background-color: #eee; font-size: 14px;}
		
		.info-ul { margin: 20px 0; }
		.deal-ul{ margin-bottom: 60px;}
		
		.con-dialog { width: 200px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;}
		
		footer {
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 50px;
			background-color: white;
			display: none;
			/* display: flex; */
			justify-content: space-around;
			align-items: center;
		}
		.footer-item { 
			border-radius: 5px; 
			width: 45%; height: 43px; 
			line-height: 43px; 
			text-align: center;
			border: 1px solid #7EB6FF;
		}
		.nopass { color: #7EB6FF; }
		.pass { background-color: #7EB6FF; color: #fff; }
		
		
		/* 展示退回 原因的容器 start*/
		.returnTitle,
		.returnCont {
			background-color: #fff;
		    display: none;
		    width: 100%;
		    font-size: 14px;
		    padding: 0 2.5%;
				line-height: 30px;
		}
		.returnCont {
			margin-bottom: 30px;
		}
		
		
		/* --------- 弹出平台协议的样式------  */
		.ctra-dialog {background-color: #FFF; display: none; position: fixed; width: 100%; height: 100vh; overflow-y: auto; left: 0; top: 0; z-index: 120;}
			
		.ctra-header {
				position: fixed;
				top: 0;
				left: 0;
				text-align: center;
				width: 100%;
				height: 44px;
				line-height: 44px;
				background-color: white;
				box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
				font-weight: bold;
				font-size: 16px;
		}
		
		.ctra-header>img {
				position: absolute;
				top: 12px;
				left: 5px;
				width: 20px;
				height: 20px;
		}
		p {margin: 0;}
		.itemContent {
				width: 100%;
				/* height: calc(100vh - 20px); */
				margin-top: 40px;
				padding: 15px 8px 0 15px;
		}
		.type-title{
		 display: none;	margin: 60px 0 20px; border: 1px solid #7EB6FF; color: #7EB6FF; height: 44px; line-height: 44px; font-size: 18px; text-align: center;
		}
		
		.select-back {
			position: absolute;
			width: 80px;
			/* line-height: 46px; */
			color: #7EB6FF;
			top: 0;
			left: 5px;
		}
		
		.imgBox {
			width: 96%;
			height: 40vh;
			border: 1px solid #aaaaaa;
			margin: 20px auto;
		}
		
		.imgBox>img {
		    width: 100%;
		    height: 100%;
		}
	</style>
</head>

<body>
	<!-- 装 每个协议的容器 -->
	<div class="ctra-dialog">
		<header class="ctra-header">
		  <!-- <img class="back" src="../../img/back_black.png" alt=""> 慧业通服务平台条款 -->
			<div class="back select-back"> <<返回 </div>
			<span class="title-span">协议详情</span>
		</header>
		<div class="type-title"></div>
		<div class="itemContent">
		
		</div>
		<!-- 图片预览放大的功能 -->
		<!-- <section class="imgzoom_pack">
			<div class="imgzoom_x">X</div>
			<div class="imgzoom_img"><img src="" /></div>
		</section> -->
	</div>
	
	
	<header>
			<img class="back" src="../../../img/back_black.png" alt=""> 收入信息
	</header>
	<div class="the-place"></div>
	<!-- <div class="ul-title">收款方信息:</div> -->
	<ul class="com-ul">
		<li class="accptcom">
				<span>接受服务的单位</span>
				<div>
						<span class="accptcom-li"></span>
				</div>
		</li>
	</ul>
	
	<!-- <div class="ul-title">付款方信息:</div> -->
	<ul class="info-ul">
		<li class="fkcode">
				<span>付款账号</span>
				<div>
						<span class="fkcode-li con-dialog" id="fkcode-dialog"></span>
						<img class="nextImg" src="../../../img/next.png" alt="">
				</div>
		</li>
		<li class="yzname">
				<span>收款人</span>
				<div>
						<span class="yzname-li"></span>
				</div>
		</li>
		<li class="skcard">
				<span>收款账号</span>
				<div>
						<span class="skcard-li"></span>
						<!-- <input class="skcard" disabled/> -->
				</div>
		</li>
		<li class="xname">
				<span>项目名称</span>
				<div>
						<span class="xname-li"></span>
				</div>
		</li>
		<li class="descripts">
				<span>项目内容</span>
				<div>
					<span class="descripts-li con-dialog" id="descripts-dialog"></span>
					<img class="nextImg" src="../../../img/next.png" alt="">
				</div>
		</li>
		<li class="zq">
				<span>服务周期</span>
				<div>
						<span class="zq-li"></span>
				</div>
		</li>
		<li class="fkmoney">
				<span>付款金额</span>
				<div>
						<span class="fkmoney-li fwstyle"></span>
				</div>
		</li>
		<li class="ysmoney">
				<span>应得金额</span>
				<div>
						<span class="ysmoney-li fwstyle"></span>
				</div>
		</li>
	</ul>
	
	<!-- <div class="ul-title">内容详情:</div> -->
	<ul class="deal-ul">
		<li class="deal">
				<span>业务合同</span>
				<div>
						<span class="deal-li"></span>
						<img class="nextImg" src="../../../img/next.png" alt="">
				</div>
		</li>
	</ul>
	
	<footer>
		<div class="footer-item nopass">退回</div>
		<div class="footer-item pass">确认</div>
	</footer>
	
	<!-- 审核退回时显示 -->
	<div class="returnTitle">退回原因：</div>
	<div class="returnCont"></div>

</body>
<script src="../../../js/jquery-3.3.1.js"></script>
<script src="../../../js/urlDns.js"></script>
<script src="../../../js/layer/layer.js"></script>

<script type="text/javascript">
	mui.init({
		beforeback: function() {
			if(is_agree){
				backActive()
				return false
			}
			else{ 
				// history.go(-2)
				return true 
			}
		}
	})
	// 返回=======================
	$(".back").click(() => {
		mui.back();
	});
	// 返回之前要执行的操作 函数
	function backActive() {
		sessionStorage.removeItem("incomeDetailId");
		sessionStorage.removeItem("comname");
		if(is_agree) {
			$(".ctra-dialog").css("display","none")
			is_agree = false
		}
	}
		
	// 用户是否处在 条款详情页
	var is_agree = false 
	
	
	// mui.init({
	// 	beforeback: function() {
	// 		backActive()
	// 		return true
	// 	}
	// })
	// // 返回=======================
	// $(".back").click(() => {
	// 	mui.back();
	// });
	// // 返回之前要执行的操作 函数
	// function backActive() {
	// 	sessionStorage.removeItem("incomeDetailId");
	// 	sessionStorage.removeItem("comname");
	// }
	
	var pass_app = localStorage.getItem("pass_app");
	var tel_app = localStorage.getItem("tel_app");
	var code_app = localStorage.getItem("code_app");

	// 获取进入的状态值
	var income_status = sessionStorage.getItem("income_status")
	
	// 该条  公司id
	var incomeDetailId = sessionStorage.getItem("incomeDetailId");
	// 获取 公司名称
	var comname = sessionStorage.getItem("comname")
	// console.log(incomeDetailId)
	$(".accptcom-li").text(comname);
	$(".accptcom").attr("id", incomeDetailId);
	
	// 如果状态码是1  income_status == 1
	if(income_status == 5){
		$(".returnTitle").css("display","block")
		$(".returnCont").css("display","block")
	}
	else if(income_status == 1){
		$("footer").css("display","flex")
	}
	
	
	let xy_type   // 协议类型
	let imgs   // 协议内容
	// $.ajaxSettings.async = false;   // 取消ajax的异步请求,, 让协议加载完成之后再做监听
	$(function() {
		$.post(urlDns + "/control_app/yz/zf/editUI", {
		    id: incomeDetailId,
		    pass_app: pass_app,
		    tel_app: tel_app,
		    code_app: code_app
		}, function(data) {
		    // console.log(JSON.stringify(data))
		    if (data.result == 0) {
		        // 需要重新登录
		        if (window.plus) {
		            goToLogin("../../register/login.html");
		        } else {
		            document.addEventListener('plusready', goToLogin, false);
		        }
		    } else {
						xy_type = data.xy_type
						imgs = data.imgs
						// console.log(JSON.stringify(imgs))
		        // $(".accptcom-li").text(data.comname);
		        // $(".accptcom").attr("id", data.ttid);
						
						$(".fkcode-li").text(data.fk_code);
		        $(".yzname-li").text(data.yzname);
		        $(".skcard-li").text(data.skcard);
						
		        $(".xname-li").text(data.name);
		        $(".descripts-li").text(data.descripts);
		        $(".zq-li").text(data.zq);
		        $(".fkmoney-li").text(data.fkmoney);
						$(".ysmoney-li").text(data.ysmoney);
						
		        if (data.reasons) {
		            $(".returnCont").text(data.reasons);
		        }
		    }
		})
	});
	
	// 点击 付款账号
	$("#fkcode-dialog").click(()=>{
		// 展示详细信息
		mui.alert($("#fkcode-dialog").html(),'详细内容','关闭','','div')
	})
	// 点击 项目内容
	$("#descripts-dialog").click(()=>{
		// 展示详细信息
		mui.alert($("#descripts-dialog").html(),'项目内容','关闭','','div')
	})
	
	
	// 点击通过
	$(".pass").click(() => {
		console.log("tsgo0000")
		$.post(urlDns + '/control_app/yz/zf/check', {
					ids: incomeDetailId,
					pass_app: pass_app,
					tel_app: tel_app,
					code_app: code_app
			}, function (data) {
					// console.log(JSON.stringify(data))
					if (data.result == 0) {
							// 需要重新登录
							if (window.plus) {
									goToLogin("../../../page/register/login.html");
							} else {
									document.addEventListener('plusready', goToLogin, false);
							}
					} else {
							mui.toast('通过成功!',{ duration:'4000', type:'div' })
							mui.back();
							// location.href = "./taxesCheck/taxset_list";
					}
			});
	})
	
	
	// 退回
	$(".nopass").click(() => {
	    sessionStorage.setItem("type", "incomeReturn");
	    location.href = "../../textPage.html";
	});
	
	// 点击业务合同===========================
	$(".deal").click(() => {
	  is_agree = true
	  $(".ctra-dialog").css("display","block")
	  // if ($(document.body).height() < $(window).height() - 185) {
	  //     // 减掉的64是除了$(".cont")以外其他元素的高度
	  //     $(".itemContent").css("height", "calc(100vh - 64px)");
	  // }
	  if(xy_type==2) {
	  	$(".itemContent").html(imgs);
	  }
	  else {
	  	let htmlStr = "";
	  	// let img_arr = imgs.split(",")
	  	let len = imgs.length || 0
	  	for (var i = 0; i < len; i++) {
	  			htmlStr += `
	  	<div class="imgBox" style="width: 96%; height: 70vh; border: 1px solid #aaaaaa;	margin: 10px auto;">
	  			<img class="img-crt" src="${imgs[i]}" style="width:100%; height:100%;" alt="">
	  	</div>
	  	`;
	  	}
	  	$(".itemContent").html(htmlStr);
	  }
	});
			
</script>
</html>
