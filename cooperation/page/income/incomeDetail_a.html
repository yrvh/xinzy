<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../../../js/mui.min.js"></script>
    <link rel="stylesheet" href="../../../css/mui.min.css">
    <link rel="stylesheet" href="../../../css/mui.picker.min.css">
    <script src="../../../js/mui.picker.min.js"></script>
    <title>有单位业者-收入详情</title>
		
		<style type="text/css">
			body {
			    margin: 0;
			    padding: 0;
			    color: #333333;
			}
			
			header {
			    position: relative;
			    text-align: center;
			    line-height: 44px;
			    width: 100%;
			    height: 44px;
			    background-color: white;
			    box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
			    font-weight: bold;
			}
			
			header>img {
			    position: absolute;
			    top: 12px;
			    left: 5px;
			    width: 20px;
			    height: 20px;
			}
			
			.next {
			    position: absolute;
			    top: 0;
			    right: 10px;
			    line-height: 44px;
			    color: #7EB6FF;
			}
			
			.detailBox,
			.income {
			    width: 100%;
			    background-color: white;
			    margin-top: 20px;
			}
			
			.income {
			    display: none;
			    margin: 0;
			}
			
			.detailBox>div,
			.income>div {
			    width: 95%;
			    height: 46px;
			    margin-left: 2.5%;
			    border-bottom: 1px solid rgb(231, 231, 231);
			    display: flex;
			    justify-content: space-between;
			    line-height: 46px;
			    font-size: 14px;
			}
			
			.incomeTitle {
			    display: none;
			    width: 100%;
			    height: 20px;
			    font-size: 12px;
			    line-height: 20px;
			    padding-left: 2.5%;
			}
			
			.detailBox>div:nth-last-of-type(1),
			.income>div:nth-last-of-type(1) {
			    border: none;
			}
			
			.detailBox>div>div>img,
			.accptCom>div>img {
			    width: 25px;
			    height: 25px;
			    vertical-align: middle;
			}
			
			.comName,
			.serverName,
			.serverCont,
			.amount {
			    font-size: 12px;
			}
			
			.serverName,
			.amount {
			    width: 50%;
			    outline: none;
			    border: none;
			    text-align: right;
			    padding: 0;
			    color: #333333;
			}
			
			.amount {
			    color: black;
			    font-size: 14px;
			    font-weight: bold;
			}
			
			.amount,
			.serverContBox {
			    position: relative;
			    width: 50%;
			}
			
			.serverCont {
			    display: inline-block;
			    width: calc(100% - 25px);
			    overflow: hidden;
			    white-space: nowrap;
			    text-overflow: ellipsis;
			    text-align: right;
			}
			
			.serverContBox img {
			    position: absolute;
			    right: -8px;
			    top: 10px;
			}
			
			.accptCom {
			    width: 100%;
			    height: 46px;
			    background-color: white;
			    display: flex;
			    justify-content: space-between;
			    line-height: 46px;
			    font-size: 14px;
			    margin-top: 20px;
			}
			
			.accptCom {
			    padding-left: 2.5%;
			}
			
			input[disabled] {
			    background-color: white;
			}
			
			.mui-btn-blue,
			.mui-btn-primary,
			input[type="submit"] {
			    background-color: #7EB6FF;
			    border: 1px solid #7EB6FF;
			}
			
			.timeBox {
			    /* padding-right: 15px; */
			    text-align: right;
			    width: 75%;
			    color: #333333;
			    /* display: flex;
			    justify-content: space-around; */
			}
			
			#startTime,
			#endTime {
			    display: flex;
			    justify-content: space-around;
			    /* position: relative; */
			    width: 40%;
			    height: 30px;
			    border: 1px solid rgb(204, 204, 204);
			    border-radius: 4px;
			    margin-top: 8px;
			}
			
			#startTime>img,
			#endTime>img {
			    width: 16px;
			    height: 16px;
			    margin-top: 5px;
			}
			
			#startTime>span,
			#endTime>span {
			    font-size: 13px;
			    line-height: 30px;
			}
			
			.returnTitle,
			.returnCont {
			    display: none;
			    width: 100%;
			    font-size: 14px;
			    padding: 0 2.5%;
			}
			
			.returnTitle {
			    margin-top: 15px;
			}
			
			.returnCont {
			    line-height: 20px;
			}
			
			footer {
			    display: none;
			    width: 100%;
			    height: 50px;
			    position: fixed;
			    z-index: 5;
			    bottom: 0;
			    left: 0;
			    background-color: white;
			}
			
			footer div {
			    position: absolute;
			    top: 5px;
			    width: calc((100% - 45px)/2);
			    height: 40px;
			    text-align: center;
			    line-height: 40px;
			    font-size: 14px;
			    border-radius: 4px;
			}
			
			.return {
			    left: 15px;
			    border: 1px solid rgb(204, 204, 204);
			}
			
			.ok {
			    right: 15px;
			    background-color: #7EB6FF;
			    color: white;
			}
			
			.success {
			    display: none;
			    width: 100%;
			    height: 100vh;
			    position: fixed;
			    top: 0;
			    left: 0;
			    z-index: 9999;
			}
			
			.success>img {
			    width: 120px;
			    height: 120px;
			    margin-left: calc((100% - 120px)/2);
			    margin-top: calc((100vh - 120px)/2);
			}
		</style>
</head>

<body>
    <header>
        <img class="back" src="../../../img/back_black.png" alt="">
        <span>收入</span>
        <!-- <div class="next">保存</div> -->
    </header>
    <div class="accptCom">
        <span>接受服务单位</span>
        <div>
            <span class="comName"></span>
            <img src="../../../img/next.png" alt="">
        </div>
    </div>
    <div class="detailBox">

        <div style="padding-right:5px">
            <span>劳务、服务名称</span>
            <input class="serverName" disabled/>
        </div>
        <div>
            <span>劳务、服务内容</span>
            <div class="serverContBox">
                <span class="serverCont"></span>
                <img src="../../../img/next.png" alt="">
            </div>
        </div>
        <div>
            <span>开票日期</span>
            <div class="timeBox">
                <!-- <section id="startTime">
                    <span id="startDate">2019-08</span>
                    <img src="../../../img/calendar.png" alt="">
                </section>
                至
                <section id="endTime">
                    <span id="endDate">2019-09</span>
                    <img src="../../../img/calendar.png" alt="">
                </section> -->

            </div>
        </div>
        <div style="padding-right:5px">
            <span>收款金额</span>
            <input class="amount amountNum" disabled/>
        </div>
    </div>
    <!-- 退回/确认 -->
    <footer>
        <div class="return">退回</div>
        <div class="ok">确认</div>
    </footer>

    <!-- 审核通过时显示 -->
    <div class="incomeTitle">
        私人账户净收入
    </div>
    <div class="income">
        <div style="padding-right:5px">
            <span>应收入总额</span>
            <input class="amount incomeNum" value="3,000.00" />
        </div>
        <div style="padding-right:5px">
            <span>未到账</span>
            <input class="amount didntIncome" />
        </div>
        <div style="padding-right:5px">
            <span>已到账</span>
            <input class="amount didIncome" />
        </div>
    </div>

    <!-- 审核退回时显示 -->
    <div class="returnTitle">退回原因：</div>
    <div class="returnCont"></div>

    <div class="success">
        <img src="../../../img/success.png" alt="">
    </div>
</body>
<script src="../../../js/jquery-3.3.1.js"></script>
<script src="../../../js/urlDns.js"></script>
<script type="text/javascript">
	var pass_app = localStorage.getItem("pass_app");
	var tel_app = localStorage.getItem("tel_app");
	var code_app = localStorage.getItem("code_app");
	// console.log("tel_app：" + tel_app);
	// console.log("pass_app：" + pass_app);
	
	mui.init();
	
	// 返回
	$(".back").click(() => {
	    history.back();
	});
	
	// 该条记录的id
	var incomeDetailId = sessionStorage.getItem("incomeDetailId");
	console.log(incomeDetailId);
	
	var isIn = sessionStorage.getItem("isIn");
	console.log(isIn)
	if (isIn == 1) {
	    // 显示退回/确认按钮
	    $("footer").css("display", "block");
	
	    $.post(urlDns + "/control_app/yz/zf/editUI", {
	        id: incomeDetailId,
	        pass_app: pass_app,
	        tel_app: tel_app,
	        code_app: code_app
	    }, function(data) {
	        console.log(JSON.stringify(data))
	        if (data.result == 0) {
	            // 需要重新登录
	            if (window.plus) {
	                goToLogin("../../register/login.html");
	            } else {
	                document.addEventListener('plusready', goToLogin, false);
	            }
	        } else {
	            $(".comName").text(data.comname);
	            $(".comName").attr("id", data.ttid);
	            $(".serverName").val(data.name);
	            $(".serverCont").text(data.descripts);
	            $(".timeBox").text(data.startdate + "至" + data.enddate);
	            $(".timeBox").css("justify-content", "flex-end");
	            $(".amountNum").val(data.fkmoney);
	            if (data.reasons) {
	                $(".returnCont").text(data.reasons);
	            }
	        }
	    });
	}
	
	
	if (isIn == 0) {
	    // 不显示退回/确认按钮
	    $("footer").css("display", "none");
	    $.post(urlDns + "/control_app/yz/zf/editUI", {
	        id: incomeDetailId,
	        pass_app: pass_app,
	        tel_app: tel_app,
	        code_app: code_app
	    }, function(data) {
	        console.log(JSON.stringify(data))
	        if (data.result == 0) {
	            // 需要重新登录
	            if (window.plus) {
	                goToLogin("../../register/login.html");
	            } else {
	                document.addEventListener('plusready', goToLogin, false);
	            }
	        } else {
	            $(".comName").text(data.comname);
	            $(".comName").attr("id", data.ttid);
	            $(".serverName").val(data.name);
	            $(".serverCont").text(data.descripts);
	            $(".timeBox").text(data.startdate + "至" + data.enddate);
	            $(".timeBox").css("justify-content", "flex-end");
	            $(".amountNum").val(data.fkmoney);
	            if (data.reasons) {
	                $(".returnTitle").css("display", "block");
	                $(".returnCont").css("display", "block");
	                $(".returnCont").text(data.reasons);
	            }
	
	
	        }
	
	    });
	
	}
	
	// 劳务、服务内容详情
	$(".serverContBox").click(() => {
	    sessionStorage.setItem("type", "onlyRead");
	    location.href = "../../../page/textPage.html";
	});
	
	// 确认
	$(".ok").click(() => {
	    var ids = [];
	    ids.push(incomeDetailId);
	
	    $.ajax({
	        type: "post",
	        url: urlDns + "/control_app/yz/zf/check",
	        // 当参数为数组时，直接传过去后台接收不到，要设置traditional: true
	        traditional: true,
	        data: {
	            "ids": ids,
	            "pass_app": pass_app,
	            "tel_app": tel_app,
	            "code_app": code_app
	        },
	        dataType: "json",
	        success: function(data) {
	            // console.log(JSON.stringify(data));
	            if (data.result == 0) {
	                // 需要重新登录
	                if (window.plus) {
	                    goToLogin("../../register/login.html");
	                } else {
	                    document.addEventListener('plusready', goToLogin, false);
	                }
	            } else {
	                $(".success").css("display", "block");
	                setTimeout(() => {
	                    $(".success").css("display", "none");
	                    history.go(-2);
	                }, 1000);
	
	
	            }
	
	        }
	    });
	});
	
	// 退回
	$(".return").click(() => {
	    sessionStorage.setItem("type", "incomeReturn");
	    location.href = "../../../page/textPage.html";
	});
</script>

</html>