<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../../../js/mui.min.js"></script>
    <link rel="stylesheet" href="../../../css/mui.min.css">
    <script src="../../../js/mui.picker.min.js"></script>
    <link rel="stylesheet" href="../../../css/mui.picker.min.css">
    <title>纳税设置查询-详情</title>
		
		<style type="text/css">
			body {
			    margin: 0;
			    padding: 0;
			    font-size: 16px;
			    color: #333333;
			}
			
			header {
			    position: fixed;
			    top: 0;
			    left: 0;
			    z-index: 999;
			    text-align: center;
			    line-height: 44px;
			    width: 100%;
			    height: 44px;
			    background-color: white;
			    font-weight: bold;
			    box-shadow: 0 2px 2px 0 rgb(231, 231, 231);
			}
			
			header>img {
			    position: absolute;
			    top: 12px;
			    left: 5px;
			    width: 20px;
			    height: 20px;
			}
			
			header>div {
			    height: 44px;
			    line-height: 44px;
			}
			
			header>div>span {
			    color: #999999;
			}
			
			section{
			    padding: 0 15px;
			    margin-top: 20px;
			    width: 100%;
			    background-color: white;
			}
			section:nth-of-type(1){
			    margin-top: 64px;
			}
			
			section div{
			    
			    width: 100%;
			    height: 46px;
			    line-height: 46px;
			    border-bottom: 1px solid #E7E7E7;
			}
			
			section div:nth-of-type(n+1){
			    display: flex;
			    justify-content: space-between;
			}
		</style>
</head>

<body>
    <header>
        <img class="back" src="../../../img/back_black.png" alt=""> 
        <span class="name"></span>
    </header>
    <section>
        <div>增值税</div>
        <div>
            <span>征收率</span>
            <span class="zzs_zsl"></span>
        </div>
        <div>
            <span>纳税方式</span>
            <span class="zzs_nsfs"></span>
        </div>
        <div>
            <span>核定定额（元）</span>
            <span class="zzs_hdde"></span>
        </div>
    </section>

    <section>
        <div>个人所得税</div>
        <div>
            <span>附征率</span>
            <span class="gs_fzl"></span>
        </div>
        <div>
            <span>纳税方式</span>
            <span class="gs_nsfs"></span>
        </div>
        <div>
            <span>核定定额（元）</span>
            <span class="gs_hdde"></span>
        </div>
    </section>

    <section>
        <div>城市建设维护税</div>
        <div>
            <span>税率</span>
            <span class="cjs_sl"></span>
        </div>
        <div>
            <span>纳税方式</span>
            <span class="cjs_nsfs"></span>
        </div>
        <div>
            <span>核定定额（元）</span>
            <span class="cjs_hdde"></span>
        </div>
        
    </section>

    <section>
        <div>教育费附加</div>
        <div>
            <span>税率</span>
            <span class="jyfj_sl"></span>
        </div>
        <div>
            <span>纳税方式</span>
            <span class="jyfj_nsfs"></span>
        </div>
        <div>
            <span>核定定额（元）</span>
            <span class="jyfj_hdde"></span>
        </div>
    </section>

    <section>
        <div>地方教育费附加</div>
        <div>
            <span>税率</span>
            <span class="dfjyfj_sl"></span>
        </div>
        <div>
            <span>纳税方式</span>
            <span class="dfjyfj_nsfs"></span>
        </div>
        <div>
            <span>核定定额（元）</span>
            <span class="dfjyfj_hdde"></span>
        </div>
    </section>
</body>
<script src="../../../js/jquery-3.3.1.js"></script>
<script src="../../../js/urlDns.js"></script>
<script src="../../../js/layer/layer.js"></script>

<script type="text/javascript">
	mui.init();
	// 返回
	$(".back").click(() => {
	    history.back();
	});
	
	var pass_app = localStorage.getItem("pass_app");
	var tel_app = localStorage.getItem("tel_app");
	var code_app = localStorage.getItem("code_app");
	
	// 录入方式addtype（业者录入为："yz"    单位录入:"sf"）
	// 状态码income_status（1：待业者确认，3：业者退回，2.待秘书公司确认，5：秘书公司退回，6：完成）
	// 获取录入方式
	var addtype = sessionStorage.getItem("addtype");
	// 获取状态码
	var income_status = sessionStorage.getItem("income_status");
	
	// 渲染标题
	if (addtype == "sf") {
	    if (income_status == 1) {
	        $("header span").text("待业者确认");
	    }
	    if (income_status == 3) {
	        $("header span").text("业者退回");
	    }
	    if (income_status == 2) {
	        $("header span").text("待商秘公司确认");
	    }
	    if (income_status == 5) {
	        $("header span").text("商秘公司退回");
	    }
	    if (income_status == 6) {
	        $("header span").text("已完成");
	    }
	}
	if (addtype == "yz") {
	    if (income_status == 2) {
	        $("header span").text("待商秘公司审核");
	    }
	    if (income_status == 5) {
	        $("header span").text("商秘公司退回");
	    }
	    if (income_status == 6) {
	        $("header span").text("完成");
	    }
	}
	
	
	// 请求数据
	$.post(urlDns + "/control_app/hhr/zf/list", {
	    // 状态
	    status: income_status,
	    // 录入方式
	    addtype: addtype,
	    // 第几页
	    page: 1,
	    // 一页的条数
	    rows: 20,
	    // 搜索框的内容
	    name: "",
	    // 过滤条件的开始时间和结束时间
	    startdate: "",
	    enddate: "",
	    // 过滤条件的单位ID
	    sfid: "",
	    // 过滤条件的业者ID
	    yzid: "",
	    pass_app: pass_app,
	    tel_app: tel_app,
	    code_app: code_app
	}, function(data) {
	    console.log(JSON.stringify(data));
	    if (data.result == 0) {
	        // 需要重新登录
	        if (window.plus) {
	            goToLogin("../../register/login.html");
	        } else {
	            document.addEventListener('plusready', goToLogin, false);
	        }
	    } else {
	        var htmlStr = "";
	        for (var i = 0; i < data.rows.length; i++) {
	            htmlStr += `
	                <div>
	                    <input class="select" name="hh" value="beihai" type="checkbox">
	                    <div class="comTime">
	                        <span class="comName">${data.rows[i].realname}</span>
	                        <div class="href" detailId="${data.rows[i].id}">
	                            <span class="time">${data.rows[i].zq}</span>
	                            <img src="../../img/next.png" alt="">
	                        </div>
	                    </div>
	                    <div class="amount">
	                        <span>${data.rows[i].name}</span>
	                        <span>${data.rows[i].fkmoney}</span>
	                    </div>
	                </div>
	            `;
	        }
	        $(".list").html(htmlStr);
	    }
	
	});
	
	
	// 跳转详情页面
	$(document).on("click", ".list .href", function(e) {
	    var detailId = $(this).attr("detailId");
	    console.log(detailId)
	    sessionStorage.setItem('incomeDetailId', detailId);
	    // page.chooseType();
	    location.href = "./tax_query_detail.html";
	});
	
	
	// 展开/收起过滤条件
	var open = false;
	$(".filterBox").click(() => {
	    open = !open;
	    if (open == true) {
	        $(".nextImg").attr("src", "../../../img/down.png");
	        $(".filterParamBg").css("display", "block");
	    } else {
	        $(".nextImg").attr("src", "../../../img/next.png");
	        $(".filterParamBg").css("display", "none");
	    }
	});
	
	// 点击空白收起过滤条件
	$(".noneParamBg").click(() => {
	    $(".filterParamBg").css("display", "none");
	    $(".nextImg").attr("src", "../../../img/next.png");
	    open = !open;
	});
	
	// 当点击搜索框的时候，把筛选条件框收起来
	$(".searchBox").click(() => {
	    $(".nextImg").attr("src", "../../../img/next.png");
	    $(".filterParamBg").css("display", "none");
	    open = !open;
	});
	
	
	// 选择筛选的日期
	$("#startTime").on("click", starTimeLen);
	$("#endTime").on("click", endTimeLen);
	var year = new Date().getFullYear();
	var month = new Date().getMonth() + 1;
	var nowdate = new Date().getDate();
	// 默认时间为当前月份
	$("#startDate").text(year + "-" + format(month) + "-" + format(nowdate));
	$("#endDate").text(year + "-" + format(month) + "-" + format(nowdate));
	
	// 格式化时间
	function format(num) {
	    if (num < 10) {
	        return "0" + num;
	    } else {
	        return num
	    }
	}
	
	// 服务周期开始时间
	function starTimeLen() {
	    var dtPicker = new mui.DtPicker({
	        type: 'date',
	        // beginDate: new Date(year, 00),
	        endDate: new Date(year, month - 1, nowdate)
	    });
	    /*  type参数：'datetime'-完整日期视图(年月日时分)
	            'date'--年视图(年月日)
	            'time' --时间视图(时分)
	            'month'--月视图(年月)
	            'hour'--时视图(年月日时)
	    */
	    dtPicker.show(function(selectItems) {
	        var y = selectItems.y.text; //获取选择的年
	        var m = selectItems.m.text; //获取选择的月
	        var d = selectItems.d.text; //获取选择的日
	        var date = y + "-" + m + "-" + d;
	        $("#startDate").text(date);
	    })
	}
	
	// 服务周期结束时间
	function endTimeLen() {
	    var dtPicker = new mui.DtPicker({
	        type: 'date',
	        // beginDate: new Date(year, 00),
	        endDate: new Date(year, month - 1, nowdate)
	    });
	
	    dtPicker.show(function(selectItems) {
	        var y = selectItems.y.text; //获取选择的年
	        var m = selectItems.m.text; //获取选择的月
	        var d = selectItems.d.text; //获取选择的日
	        var date = y + "-" + m + "-" + d;
	        $("#endDate").text(date);
	    });
	}
	
	
	// 重置筛选条件
	$(".reset").click(() => {
	    $(".selectComName").text("");
	    $("#startDate").text(year + "-" + format(month));
	    $("#endDate").text(year + "-" + format(month));
	});
	
	// ================================================
	var comArr = [];
	$.post(urlDns + "/control_app/yz/tt/list", {
	        pass_app: pass_app,
	        tel_app: tel_app,
	        code_app: code_app
	    },
	    function(data) {
	        // console.log(JSON.stringify(data))
	        for (var i = 0; i < data.rows.length; i++) {
	            comArr.push({ "value": data.rows[i].id, "text": data.rows[i].name });
	        }
	        // console.log(JSON.stringify(comArr))
	    });
	
	// 选择接受服务单位
	$(".selectCom").on("click", selectCom);
	
	function selectCom() {
	    var popPicker = new mui.PopPicker();
	    popPicker.setData(comArr)
	        // [{ value: 'ywj', text: '北海骄龙网络有限公司' },
	        //     { value: 'aaa', text: 'xxxxxxx有限公司' },
	        //     { value: 'lj', text: 'xxxxxxx有限公司' },
	        //     { value: 'ymt', text: 'xxxxxxx有限公司' },
	        // ]
	    popPicker.show(function(selectItems) {
	        $(".selectComName").text(selectItems[0].text);
	        $(".selectComName").attr("id", selectItems[0].value);
	        // console.log(selectItems[0].text);
	        // console.log(selectItems[0].value);
	    })
	}
	// ================================================
	
	
	
	// 加载下一页
	$(window).scroll(function() {
	    if ($(window).scrollTop() + $(window).height() == $(document).height()) {
	        page = page + 1;
	        console.log(page)
	        $.post(urlDns + "/control_app/yz/fp/list", {
	            // 状态  待提交0
	            status: status,
	            // 第几页
	            page: page,
	            // 一页的条数
	            rows: 20,
	            // 搜索框的内容
	            name: "",
	            // 过滤条件的开始时间和结束时间
	            startdate: "",
	            enddate: "",
	            // 过滤条件的发票抬头
	            comid: "",
	            pass_app: pass_app,
	            tel_app: tel_app,
	            code_app: code_app
	        }, function(data) {
	            console.log(JSON.stringify(data));
	            if (data.result == 0) {
	                // 需要重新登录
	                if (window.plus) {
	                    goToLogin("../register/login.html");
	                } else {
	                    document.addEventListener('plusready', goToLogin, false);
	                }
	            } else {
	                if (data.rows.length > 0) {
	                    var htmlStr = "";
	                    for (var i = 0; i < data.rows.length; i++) {
	                        htmlStr += `
	                            <div class="${data.rows[i].id}">
	                                <input class="select" name="hh" value="beihai" type="checkbox">
	                                <div class="comTime">
	                                    <span class="comName">${data.rows[i].comname}</span>
	                                    <div class="href" detailId="${data.rows[i].id}">
	                                        <span class="time">${data.rows[i].addtime}</span>
	                                        <img src="../../img/next.png" alt="">
	                                    </div>
	                                </div>
	                                <div class="amount">
	                                    <span>${data.rows[i].name}</span>
	                                    <span>${data.rows[i].money}</span>
	                                </div>
	                            </div>
	                        `;
	                    }
	                    $(".list").append(htmlStr);
	                }
	            }
	
	
	        });
	    }
	});
</script>

</html>