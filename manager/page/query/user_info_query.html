<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../../../js/mui.min.js"></script>
    <link rel="stylesheet" href="../../../css/mui.min.css">
    <title>用户信息查询</title>
    <script>
        mui.init();
    </script>
		
		<style type="text/css">
			body {
			    margin: 0;
			    padding: 0;
			    color: #333333;
			}
			
			header {
			    position: fixed;
			    top: 0;
			    left: 0;
			    z-index: 99;
			    text-align: center;
			    line-height: 44px;
			    width: 100%;
			    height: 44px;
			    font-weight: bold;
			    background-color: white;
			    box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
			}
			
			header>img {
			    position: absolute;
			    top: 12px;
			    left: 5px;
			    width: 20px;
			    height: 20px;
			}
			
			header>div {
			    position: absolute;
			    top: 0;
			    right: 5px;
			    height: 44px;
			    line-height: 44px;
			}
			
			.next {
			    line-height: 44px;
			    color: #7EB6FF;
			    margin-right: 10px;
			}
			
			.userTypeBox{
			    position: fixed;
			    top: 44px;
			    left: 0;
			    z-index: 99;
			    width: 100%;
			    height: 45px;
			    background-color: white;
			    display: flex;
			    justify-content: space-around;
			}
			
			.userTypeBox div{
			    line-height: 45px;
			    
			    box-sizing: border-box;
			}
			
			.user_all{
			    border-bottom: 3px solid #7EB6FF;
			}
			.user_com,.user_free,.user_coop{
			    border: none;
			}
			.user_numTip{
			    position: fixed;
			    top: 88px;
			    left: 0;
			    z-index: 99;
			    width: 100%;
			    height: 30px;
			    line-height: 30px;
			    font-size: 14px;
			    padding: 0 15px;
			    display: flex;
			    justify-content: space-between;
			    background-color: #efeff4;
			}
			
			.inserver{
			    position: fixed;
			    top: 118px;
			    left: 0;
			    z-index: 99;
			    width: 100%;
			    height: 46px;
			    padding: 0 15px;
			    line-height: 46px;
			    background-color: white;
			    display: flex;
			    justify-content: space-between;
			}
			
			
			.list {
				list-style: none;
				padding: 0;
				margin-top: 0;
				margin-bottom: 15px;
			}
			/* .com_ul,.free_ul,.coop_ul {
			    list-style: none;
			    padding: 0;
					margin-top: 0;
					margin-bottom: 15px;
			} */
			
			li {
			    display: flex;
			    justify-content: space-between;
			    width: 100%;
			    height: 46px;
			    background-color: white;
			    margin-bottom: 2px;
			    line-height: 46px;
			    padding: 0 5px 0 15px;
			    box-sizing: border-box;
			}
			
			li img {
			    width: 25px;
			    height: 25px;
			    vertical-align: middle;
			}
			
			li>div>span {
			    color: rgb(153, 153, 153);
			}
			
			.place {width: 100%; height: 119px;}
			
			.amount {
				display: none;
				height: 30px;
				line-height: 30px;
				font-size: 12px;
				color: #999999;
				padding: 0 15px 0 15px;
			}
		</style>
</head>

<body>
    <header>
        <img class="back" src="../../../img/back_black.png" alt=""> 用户状态统计
        <!-- <div class="next">新增</div> -->
    </header>
    <div class="userTypeBox">
        <div class="user_com">单位用户</div>
        <div class="user_free">业者用户</div>
        <div class="user_coop">合作伙伴</div>
        <!-- <div class="tip"></div> -->
    </div>

    <div class="user_numTip">
        <div>用户名称</div>
        <div>用户数量: <span class="user_num"></span></div>
    </div>
		<div class="place"></div>
		<ul class="list"></ul>
		<!-- <ul class="com_ul">
			<li class="cominfo">
			    <span>北海农夫山泉集团</span>
			    <div>
			        <span class="pass">1872220000</span>
			        <img src="../../../img/next.png" alt="">
			    </div>
			</li>
			<li class="cominfo">
			    <span>北海娃哈哈集团</span>
			    <div>
			        <span class="pass">1872220000</span>
			        <img src="../../../img/next.png" alt="">
			    </div>
			</li>
		</ul>
		
		<ul class="free_ul">
			<li class="freeinfo">
			    <span>张可可</span>
			    <div>
			        <span class="pass">1872220000</span>
			        <img src="../../../img/next.png" alt="">
			    </div>
			</li>
			<li class="freeinfo">
			    <span>李四</span>
			    <div>
			        <span class="pass">1872220000</span>
			        <img src="../../../img/next.png" alt="">
			    </div>
			</li>
		</ul>
		
		<ul class="coop_ul">
			<li class="coopinfo">
			    <span>马建军</span>
			    <div>
			        <span class="pass">1872220000</span>
			        <img src="../../../img/next.png" alt="">
			    </div>
			</li>
			<li class="coopinfo">
			    <span>马建军</span>
			    <div>
			        <span class="pass">1872220000</span>
			        <img src="../../../img/next.png" alt="">
			    </div>
			</li>
		</ul> -->


</body>
<script src="../../../js/jquery-3.3.1.js"></script>
<script src="../../../js/urlDns.js"></script>

<script type="text/javascript">
	var pass_app = localStorage.getItem("pass_app");
	var tel_app = localStorage.getItem("tel_app");
	var code_app = localStorage.getItem("code_app");
	
	// 返回
	$(".back").click(() => {
	    history.back();
	})
	
	let addtype = 2
	// 初始化界面
	getInfo(2)
	
	$(".user_com").click(() => {
		// 单位
		addtype = 2
		$(".amount").css("display","block")
		$(".user_all").css("border-bottom","none")
		$(".user_com").css("border-bottom", "3px solid #7EB6FF")
		$(".user_free").css("border-bottom","none")
		$(".user_coop").css("border-bottom","none")
	  getInfo(2)
	})
	$(".user_free").click(() => {
		// 业者
		addtype = 1
		$(".amount").css("display","none")
		$(".user_all").css("border-bottom","none")
		$(".user_com").css("border-bottom","none")
		$(".user_free").css("border-bottom", "3px solid #7EB6FF")
		$(".user_coop").css("border-bottom","none")
	  getInfo(1)
	})
	$(".user_coop").click(() => {
		// 合作伙伴
		addtype = 11
		$(".amount").css("display","none")
		$(".user_all").css("border-bottom","none")
		$(".user_com").css("border-bottom","none")
		$(".user_free").css("border-bottom","none")
		$(".user_coop").css("border-bottom", "3px solid #7EB6FF")
		getInfo(11)
	})
	
	var page = 1   // 设置当前 在第几个页面
	
	// 定义函数, 发起请求,
	function getInfo(name='',sfid='',yztype=2,hhrid='',yxyid='',ywyid='') {
		
		// 请求数据
		mui.post(urlDns + "/control_app/ms/fr/user/list", {
			usertype: addtype,
			// 状态
			stauts: 0,
			// 第几页
			page: page,
			// 一页的条数
			rows: 20,
			// 搜索框的内容
			tel: name,
			// 过滤条件的单位ID
			sfid,
			// 过滤条件的业者ID
			yztype,
			hhrid,
			yxyid,
			ywyid,
			pass_app: pass_app,
			tel_app: tel_app,
			code_app: code_app
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} else {
				$(".list").html('');   // 发起请求之前,先清空页面
				var htmlStr = "";
				for (let i = 0; i < data.rows.length; i++) {
					htmlStr +=`
						<div>
								<input class="select" name="hh" value="beihai" type="checkbox">
								<div class="comTime">
										<span class="comName">${data.rows[i].name}</span>
										<div class="href" detailId="${data.rows[i].id}">
												<span class="time">${data.rows[i].details}</span>
												<img src="../../../img/next.png" alt="">
										</div>
								</div>
								<div class="amount">
										<span>${data.rows[i].icon}</span>
										<span>${data.rows[i].tel}</span>
								</div>
						</div>
					`;
				}
				$(".list").html(htmlStr);
			}
		});
	}
	
	
	// 跳转详情页面
	$(document).on("click", ".list .href", function(e) {
		var detailId = $(this).attr("detailId");
		sessionStorage.setItem('detailId', detailId);
		
		if(addtype==2) {
			console.log("跳入了公司详情页")
			location.href = "./user_detail_com.html";
		}
		if(addtype==1 || addtype==11) {
			console.log("跳入了 业者 伙伴 详情页")
			sessionStorage.setItem("detailType",addtype)
			location.href = "./user_detail_free.html";
		}
	});

	
	// 加载下一页
	let page= 1
	$(window).scroll(function() {
		if ($(window).scrollTop() + $(window).height() == $(document).height()) {
			page = page + 1;
			getInfoScroll(utype,page)
		}
	});
	
	// 滚动时加载页面用的函数
	function getInfoScroll(usertype=0,page=1,status=1,tel='') {
		$.post(urlDns + "/control_app/ms/fr/user/list", {
			tel_app: tel_app,
			pass_app: pass_app,
			code_app: code_app,
			page, //第几页
			rows: "20",  //页数大小
			tel,//搜索字段
			usertype: usertype,//用户类型1.业者  2.单位    11  合作伙伴,  0全部
			status //1.审核通过      0.注册当中
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} else {
				if (data.rows.length > 0) {
					var htmlStr = "";
					for (var i = 0; i < data.rows.length; i++) {
						htmlStr +=
							`
							<li class="list${data.rows[i].usertype}" user_id="${data.rows[i].id}" usertype="${data.rows[i].usertype}">
									<span>${data.rows[i].name}</span>
									<div>
											<span class="com_djlqr">${data.rows[i].tel}</span>
											<img src="../../../img/next.png" alt="">
									</div>
							</li>
							`;
					}
					$(".list").append(htmlStr);
				}
			}
		});
	}
	
</script>


</html>