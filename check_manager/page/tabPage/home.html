<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge"/>
		<script src="../../../js/mui.min.js"></script>
		<link rel="stylesheet" type="text/css" href="../../../css/mui.min.css"/>
    <title>审核主管首页</title>
		
		<style type="text/css">
			body { margin: 0; padding: 0; font-size: 16px; }
			
			.mui-slider .mui-slider-group .mui-slider-item img { height: 220px; }
			.line { width: 100%; height: 30px; background-color: white; }
			
			.home_income { width: 100%; height: 180px; background-color: white; }
			.home_income>div { position: relative; width: 25%; text-align: center; float: left; font-size: 13px; }
			.home_income>div>img { margin-top: 10px; width: 48px; height: 48px; }
			
			.mybadge {
				position: absolute;
				right: 15px;
				top: 5px;
				display: none;
			}
		</style>
	</head>
	<body>
		<!-- 头部轮播图 -->
		<div class="mui-slider">
			<div class="mui-slider-group mui-slider-loop">
			    <!--支持循环，需要重复图片节点-->
			    <div class="mui-slider-item mui-slider-item-duplicate">
			        <a href="#"><img src="../../../img/slider1.jpg" /></a>
			    </div>
			    <div class="mui-slider-item">
			        <a href="#"><img src="../../../img/indexBgImg.png" /></a>
			    </div>
			    <div class="mui-slider-item">
			        <a href="#"><img src="../../../img/slider1.jpg" /></a>
			    </div>
			    <!--支持循环，需要重复图片节点-->
			    <div class="mui-slider-item mui-slider-item-duplicate">
			        <a href="#"><img src="../../../img/indexBgImg.png" /></a>
			    </div>
			</div>
		</div>
		
		<div class="line"></div>
		<div class="home_income">
			<div class="user_mana">
				<span class="mybadge mui-badge mui-badge-danger"></span>
				<img src="../../../img/userCheck.png" alt="" />
				<div>用户管理</div>
			</div>
			<div class="income_mana">
				<span class="mybadge mui-badge mui-badge-danger"></span>
				<img src="../../../img/userManage.png" alt="" />
				<div>收入管理</div>
			</div>
			<div class="taxes_mana">
				<img src="../../../img/taxesSetCheck.png" alt="" />
				<div>税收政策设置</div>
			</div>
			<div class="taxes_check">
				<span class="mybadge mui-badge mui-badge-danger"></span>
				<img src="../../../img/taxesCheck.png" alt="" />
				<div>纳税设置审核</div>
			</div>
			<div class="contract_mana">
				<img src="../../../img/invoice.png" alt="" />
				<div>协议管理</div>
			</div>
			<div class="invoice_mana">
				<img src="../../../img/invoiceCheck.png" alt="" />
				<div>发票管理</div>
			</div>
		</div>
	</body>
	<script src="../../../js/jquery-3.3.1.js"></script>
	<script src="../../../js/layer/layer.js"></script>
	<script src="../../../js/urlDns.js"></script>

<script type="text/javascript">
	mui.init();
	
	var pass_app = localStorage.getItem("pass_app");
	var tel_app = localStorage.getItem("tel_app");
	var code_app = localStorage.getItem("code_app");
	
	// 用户管理
	$(".user_mana").click(()=>{
		mui.openWindow('../userMana/userMana.html')
	})
	// 收入管理
	$(".income_mana").click(()=>{
		mui.openWindow('../incomeMana/incomeMana.html')
	})
	// 税收政策设置
	$(".taxes_mana").click(()=>{
		mui.openWindow('../taxesMana/taxesMana.html')
	})
	// 纳税设置审核
	$(".taxes_check").click(()=>{
		mui.openWindow('../taxesCheck/taxesCheck.html')
	})
	// 协议管理
	$(".contract_mana").click(()=>{
		mui.openWindow('../contractMana/contractMana.html')
	})
	// 发票管理
	$(".invoice_mana").click(()=>{
		mui.openWindow('../invoiceMana/invoiceMana.html')
	})
	
	
	$.ajaxSettings.async = false;   // 取消ajax的异步请求,, 让协议加载完成之后再做监听
	
	// 获取用户管理中, 有多少条是 待审核
	let user_mana_badge = 0

	$(function userManaBadge() {
		mui.post(urlDns + "/control_app/ms/fr/user/main",{
		    // 2.有单位  1.业者用户  11.合作伙伴
		    tel_app:tel_app,
		    pass_app:pass_app,
		    code_app:code_app,
				usertype: 2
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} 
				else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} 
			else {
				user_mana_badge += data.dw_1   // 单位的数据累加进来
				
				// 请求业者的  待审核数据
				mui.post(urlDns + "/control_app/ms/fr/user/main",{
				    // 2.有单位  1.业者用户  11.合作伙伴
				    tel_app:tel_app,
				    pass_app:pass_app,
				    code_app:code_app,
						usertype: 1
				}, function(data) {
					// console.log(JSON.stringify(data));
					if (data.result == 0) {
						// 需要重新登录
						if (window.plus) {
							goToLogin("../../../page/register/login.html");
						} 
						else {
							document.addEventListener('plusready', goToLogin, false);
						}
					} 
					else {
						user_mana_badge += data.yz_7   // 业者的数据累加进来
						
						// 请求合伙人  数据
						mui.post(urlDns + "/control_app/ms/fr/user/main",{
						    // 2.有单位  1.业者用户  11.合作伙伴
						    tel_app:tel_app,
						    pass_app:pass_app,
						    code_app:code_app,
								usertype: 11
						}, function(data) {
							// console.log(JSON.stringify(data));
							if (data.result == 0) {
								// 需要重新登录
								if (window.plus) {
									goToLogin("../../../page/register/login.html");
								} 
								else {
									document.addEventListener('plusready', goToLogin, false);
								}
							} 
							else {
								user_mana_badge += data.hhr_7   // 合伙人的数据累加进来
								
								// 渲染
								if(user_mana_badge>0){
										$(".user_mana .mybadge").css("display","block")
										$(".user_mana .mybadge").text(user_mana_badge)
									}
								else { $(".user_mana .mybadge").css("display","none") }
							}
						});	 
					}
					
				});	
			}
			
		});
		
		

	})
	
	
	// 获取收入管理中,  待支付的数量
	$(function() {
		$.post(urlDns + "/control_app/ms/fr_zg/zf/index", {
				pass_app: pass_app,
				tel_app: tel_app,
				code_app: code_app
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
					// 需要重新登录
					if (window.plus) {
							goToLogin("../../../page/register/login.html");
					} else {
							document.addEventListener('plusready', goToLogin, false);
					}
			} 
			else {
				if(data.wait_pay > 0) {
					$(".income_mana .mybadge").css("display","block")
					$(".income_mana .mybadge").text(data.wait_pay)
				}
				else { $(".income_mana .mybadge").css("display","none") }
			}
		});
	})
	
	// 获取纳税设置审核中,  待审核的数量
	$(function() {
		$.post(urlDns + "/share/bs_app/nssetting/index", {
				pass_app: pass_app,
				tel_app: tel_app,
				code_app: code_app
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
					// 需要重新登录
					if (window.plus) {
							goToLogin("../../../page/register/login.html");
					} else {
							document.addEventListener('plusready', goToLogin, false);
					}
			} 
			else {
				if(data.wait_check > 0) {
					$(".taxes_check .mybadge").css("display","block")
					$(".taxes_check .mybadge").text(data.wait_check)
				}
				else { $(".taxes_check .mybadge").css("display","none") }
			}
		});
	})
</script>
</html>
