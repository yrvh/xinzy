<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<script src="../../../js/mui.min.js"></script>
	<link rel="stylesheet" href="../../../css/mui.min.css">
	<link rel="stylesheet" href="../../../css/mui.picker.min.css">
	<script src="../../../js/mui.picker.min.js"></script>
	<title>审核主管--收入管理--列表页</title>

	<style type="text/css">
		body {
			/* position: relative; */
			margin: 0;
			padding: 0;
			color: #333333;
		}

		header {
			box-sizing: border-box;
			position: fixed;
			top: 0;
			left: 0;
			z-index: 50;
			text-align: center;
			line-height: 44px;
			width: 100%;
			height: 44px;
			background-color: white;
			box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
		}

		header>img {
			position: absolute;
			top: 12px;
			left: 5px;
			width: 20px;
			height: 20px;
		}

		header>div {
			position: absolute;
			top: 0;
			right: 5px;
			height: 44px;
			line-height: 44px;
		}

		header>div>span {
			color: #999999;
		}

		.list {
			margin-top: 152px;
			margin-bottom: 20px;
		}

		.list>div {
			position: relative;
			width: 100%;
			background-color: white;
			margin-top: 10px;
		}

		.list>div:nth-of-type(1) {
			margin-top: 20px;
		}


		/* .list>div:nth-last-of-type(1) {
				margin-bottom: 10px;
		} */

		.list>div>div {
			width: 100%;
			display: flex;
			justify-content: space-between;
		}

		.list>div img {
			width: 25px;
			height: 25px;
			vertical-align: middle;
		}

		.list>div>div:nth-of-type(1) {
			height: 40px;
			line-height: 40px;
			border-bottom: 1px solid rgb(240, 240, 240);
			font-size: 14px;
			padding: 0 5px 0 15px;
		}

		.time {
			color: #999999;
		}

		.amount {
			height: 30px;
			line-height: 30px;
			font-size: 12px;
			color: #999999;
			padding: 0 15px 0 15px;
		}

		.searchBox {
			/* display: none; */
			position: fixed;
			top: 44px;
			left: 0;
			z-index: 50;
			width: 100%;
			height: 44px;
			padding: 7px 0 7px 15px;
			background-color: #F2F2F2;
		}

		.searchIn {
			position: relative;
			width: calc(100% - 60px);
			height: 30px;
			background-color: white;
			border-radius: 3px;
			box-sizing: border-box;
		}

		.searchIn>input {
			position: absolute;
			top: 0;
			left: 25px;
			padding: 0;
			width: 80%;
			height: 30px;
			font-size: 14px;
			text-align: left;
			background-color: white;
		}

		.searchIn>input::placeholder {
			font-size: 12px;
		}

		.searchImg {
			position: absolute;
			top: 7.5px;
			left: 5px;
			width: 15px;
			height: 15px;
		}

		.toEmpty {
			position: absolute;
			top: 7.5px;
			right: 10px;
			width: 15px;
			height: 15px;
		}

		.search {
			position: absolute;
			top: 0;
			right: 15px;
			line-height: 44px;
			font-size: 14px;
			color: #7EB6FF;
		}

		.del,
		.submit {
			position: absolute;
			top: 0;
			width: calc((100% - 45px)/2);
			height: 40px;
			margin-top: 5px;
			border-radius: 4px;
		}

		.del div:nth-of-type(1),
		.submit div:nth-of-type(1) {
			font-weight: bold;
		}

		.del div:nth-of-type(2),
		.submit div:nth-of-type(2) {
			color: #999999;
		}

		.del {
			left: 0;
			margin-left: 15px;
			text-align: left;
		}

		.submit {
			right: 0;
			margin-right: 15px;
			text-align: right;
		}

		.select {
			display: none;
			position: absolute;
			top: 11px;
			left: 10px;
		}

		.filterBox {
			position: fixed;
			top: 88px;
			left: 0;
			z-index: 50;
			/* display: none; */
			width: 100%;
			height: 44px;
			color: rgb(153, 153, 153);
			background-color: white;
			padding: 0 5px 0 15px;
			font-size: 14px;
			line-height: 44px;
			border-bottom: 1px solid rgb(240, 240, 240);
		}

		.nextImg {
			position: absolute;
			top: 8px;
			right: 5px;
			width: 25px;
			height: 25px;
		}

		.filterImg {
			position: relative;
			top: 2px;
			width: 15px;
			height: 15px;
		}

		.filterParam {
			background-color: white;
		}

		.selectTime {
			padding: 0 15px;
			display: flex;
			justify-content: space-between;
			width: 100%;
			height: 44px;
			background-color: white;
			border-bottom: 1px solid rgb(240, 240, 240);
			line-height: 44px;
			font-size: 14px;
		}

		.timeBox {
			width: 75%;
			display: flex;
			justify-content: space-between;
		}

		#startTime,
		#endTime {
			display: flex;
			justify-content: space-around;
			/* position: relative; */
			width: 40%;
			height: 30px;
			border: 1px solid rgb(204, 204, 204);
			border-radius: 4px;
			margin-top: 8px;
		}

		#startTime>img,
		#endTime>img {
			width: 16px;
			height: 16px;
			margin-top: 5px;
		}

		#startTime>span,
		#endTime>span {
			font-size: 13px;
			line-height: 30px;
		}

		#startDate,
		#endDate {
			color: #666666;
		}

		.free-com {
			width: 92%;
			margin: 0 auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
			height: 44px;
			border-bottom: 1px solid rgb(240, 240, 240);
		}
		.free-com>div { display: flex; justify-content: space-between; align-items: center;}
		
		.free-com span {
			font-size: 14px;
		}

		.free-com img {
			width: 25px;
			height: 25px;
			/* vertical-align: center; */
		}
		.selectCom {display: none;}

		.okBox {
			position: relative;
			width: 100%;
			height: 44px;
		}

		.okBox div {
			top: 8px;
			position: absolute;
			width: calc((100% - 45px)/2);
			height: 28px;
			border-radius: 4px;
			font-size: 14px;
			text-align: center;
			line-height: 28px;
		}

		.ok {
			right: 15px;
			color: white;
			background-color: #7EB6FF;
		}

		.reset {
			left: 8px;
			color: #7EB6FF;
			border: 1px solid rgb(204, 204, 204);
		}

		.filterParamBg {
			display: none;
			position: absolute;
			background-color: rgba(0, 0, 0, 0.2);
			z-index: 10;
			top: 133px;
			left: 0;
			width: 100%;
			height: calc(100vh - 133px);
		}

		.noneParamBg {
			/* background-color: #009F95; */
			width: 100%;
			height: calc(100vh - 480px);
			position: absolute;
			bottom: 0;
			left: 0;
		}
		
	.select_all {		
		position: absolute;
		width: 40px;
		/* line-height: 46px; */
		color: #7EB6FF;
		left: 5px;
		display: none;
	}
	footer {
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		height: 50px;
		background-color: white;
		display: none;
		justify-content: center;
		align-items: center;
		
	}
	.footer-item { border-radius: 5px; width: 90%; height: 43px; line-height: 43px; text-align: center; background-color: #7EB6FF; color: #fff;}
	
	.comName {
		position: relative;
	}
	.select-btn {display: none; line-height: 44px; color: #7EB6FF; margin-right: 10px;}
	
	.dialog-container { position: fixed; width: 100%; height: 100%; background-color: rgba(180,180,180,.8); left: 0; top: 0; z-index: 60; display: none; justify-content: center; align-items: center;}
	.dialog { width: 80%; height: 340px; background-color: #fff; padding-left: 12px; }
	
	.dialog>div { border-bottom: 1px solid #ddd; line-height: 48px; }
	.dialog input {width: 50%; font-size: 15px; border: none; margin: 0 3px 0 0;}
	.dialog-title { font-size: 19px; font-weight: 800; padding: 14px 0 9px;}
	/* .dialog-money { margin: 20px 0;} */
	.dialog-tel {display: flex; }
	.get-code {font-size: 12px; color: #7EB6FF; font-family: "Microsoft YaHei"; font-weight: 600;}
	.dialog-code {margin-bottom: 40px;}
	.dialog-btn {
		width:300px;
		border-radius: 4px;
		text-align: center;
		margin: 0 auto;
		border: 1px solid #7EB6FF !important;
		transform: translateX(-6px);
		display: flex;
		justify-content: space-between;
		overflow: hidden;
	}
	.cancel,.success {width: 50%;}
	.cancel {color: #7EB6FF;}
	.success { background-color: #7EB6FF; color: #fff; }
	
	</style>
</head>
<body>
	<!-- 当点击支付的时候,,  弹出来的对话框 -->
	<div class="dialog-container">
		<div class="dialog">
			<div class="dialog-title">支付详情:</div>
			<div class="dialog-money">总金额:&nbsp;&nbsp; ¥&nbsp;&nbsp;<span></span></div>
			<div class="dialog-tel">电话号: <input id="input-tel"  type="text" maxlength="11" name="userNum"  placeholder="请输入手机号..." /> </div>
			<div class="dialog-code">验证码: <input id="input-code" type="text" name="verify" placeholder="输入验证码..." /><span class="get-code">获取验证码</span></div>
			<div class="dialog-btn">
				<div class="cancel">取消支付</div>
				<div class="success">确认支付</div>
			</div>
		</div>
	</div>
	
	<header>
		<div class="select_all">全选</div>
		<img class="back" src="../../../img/back_black.png" alt="">
		<span></span>
		<div class="select-btn">选择</div>
	</header>
	<!-- 搜索框 -->
	<div class="searchBox">
		<div class="searchIn">
			<img class="searchImg" src="../../../img/search.png" alt="">
			<input class="searchCont" type="search" placeholder="请输入业者姓名/手机号码">
			<img class="toEmpty" src="../../../img/toEmpty.png" alt="">
		</div>
		<div class="search">搜索</div>
	</div>

	<!-- 筛选条件按钮 -->
	<div class="filterBox">
		<div>
			<img class="filterImg" src="../../../img/filter.png" alt="">
			<span>筛选条件：</span>
		</div>
		<img class="nextImg" src="../../../img/next.png" alt="">
	</div>
	<!-- 帅选条件 内容展示 -->
	<div class="filterParamBg">
		<div class="filterParam">
			<div class="selectFreeType free-com">
				<span>业者类型</span>
				<div>
					<span class="selectFreeTypeLi">全部</span>
					<img src="../../../img/next.png" alt="">
				</div>
			</div>
			
			<div class="selectCom free-com">
				<span>接受服务单位</span>
				<div>
					<span class="selectComName"></span>
					<img src="../../../img/next.png" alt="">
				</div>
			</div>
			
			<div class="selectFree free-com">
				<span>业者姓名</span>
				<div>
					<span class="selectFreeName"></span>
					<img src="../../../img/next.png" alt="">
				</div>
			</div>
			
			<div class="selectCoop free-com">
				<span>合作伙伴</span>
				<div>
					<span class="selectCoopName"></span>
					<img src="../../../img/next.png" alt="">
				</div>
			</div>
			
			<div class="selectSell free-com">
				<span>营销员</span>
				<div>
					<span class="selectSellName"></span>
					<img src="../../../img/next.png" alt="">
				</div>
			</div>
			
			<div class="selectClerk free-com">
				<span>业务员</span>
				<div>
					<span class="selectClerkName"></span>
					<img src="../../../img/next.png" alt="">
				</div>
			</div>
			
			<div class="selectTime">
				<span>服务周期</span>
				<div class="timeBox">
					<section id="startTime">
						<span id="startDate"></span>
						<img src="../../../img/calendar.png" alt="">
					</section>
					至
					<section id="endTime">
						<span id="endDate"></span>
						<img src="../../../img/calendar.png" alt="">
					</section>

				</div>
			</div>
			<div class="okBox">
				<div class="reset">重置条件</div>
				<div class="ok">确定</div>
			</div>
		</div>
		<div class="noneParamBg"></div>
	</div>


	<!-- 数据列表 -->
	<section class="list">

	</section>
	
	<footer>
		<div class="footer-item">支付</div>
	</footer>
</body>



<script src="../../../js/jquery-3.3.1.js"></script>
<script src="../../../js/urlDns.js"></script>

<script type="text/javascript">
	
	mui.init({
		beforeback: function() {
			backActive()
			return true
		}
	})
	// 返回=======================
	$(".back").click(() => {
		mui.back();
	});
	// 返回之前要执行的操作 函数
	function backActive() {
		// sessionStorage.removeItem("income_status");
	}

	var pass_app = localStorage.getItem("pass_app");
	var tel_app = localStorage.getItem("tel_app");
	var code_app = localStorage.getItem("code_app");

	// 获取状态码
	var income_status = sessionStorage.getItem("income_status");
	
	// 渲染标题
	if (income_status == 1) {
		$("header span").text("待业者确认");
	}
	if (income_status == 3) {
		$("header span").text("业者审核未通过");
	}
	if (income_status == 2) {
		$("header span").text("等待秘书公司确认");
	}
	if (income_status == 5) {
		$("header span").text("商秘公司审核未通过");
	}
	if (income_status == 6) {
		$("header span").text("等待业务员发起支付");
	}
	if (income_status == 7) {
		$("header span").text("待支付");
		$(".select-btn").css("display","block")
	}
	if (income_status == 8) {
		$("header span").text("已支付");
	}

	
	var page = 1   // 设置当前 在第几个页面
	// 通过搜索框输入的内容, 单位id 业者id, 请求数据类型的列表
	
	getInfoList()   //调用函数初始化 界面上要展示的数据列表 
	
	function getInfoList(name='',startdate='',enddate='',sfid='',yztype=2,yzid=0,hhrid='',yxyid='',ywyid='') {

		// 请求数据
		mui.post(urlDns + "/control_app/ms/fr_zg/zf/list", {
			// 状态
			status: income_status,
			// 第几页
			page: page,
			// 一页的条数
			rows: 20,
			// 搜索框的内容
			name,
			// 过滤条件的开始时间和结束时间
			startdate,
			enddate,		
			// 过滤条件的单位ID
			sfid,
			// 过滤条件的业者ID
			yzid,
			hhrid,
			yxyid,
			ywyid,
			yztype,
			pass_app: pass_app,
			tel_app: tel_app,
			code_app: code_app
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} else {
				if(page==1){ $(".list").html(''); }   // 发起请求之前,先清空页面
				var htmlStr = "";
				for (let i = 0; i < data.rows.length; i++) {
					htmlStr +=`
						<div>
								<input class="select" name="hh" value="beihai" type="checkbox">
								<div class="comTime">
										<span class="comName">${data.rows[i].name}</span>
										<div class="href" detailId="${data.rows[i].id}">
											<span class="time">${data.rows[i].zq}</span>
											<img src="../../../img/next.png" alt="">
										</div>
								</div>
								<div class="amount">
										<span>${data.rows[i].comname}</span>
										<span>${data.rows[i].fkmoney}</span>
								</div>
						</div>
					`;
				}
				$(".list").append(htmlStr);
			}
		});
	}
	
	// ======================加载下一页===================================================
	$(window).scroll(function() {
		if ($(window).scrollTop() + $(window).height() == $(document).height()) {
			// 获取各个 参数
			let name_pull = $(".searchCont").val() || ''
			let s_pull = $("#startDate").text()
			let e_pull = $("#endDate").text()
			// 获取各个角色, 人的uid
			let sf_pull = $(".selectComName").attr('uid') || ''
			let yztype_pull = $(".selectFreeTypeLi").attr('uid') || ''
			let yz_pull = $(".selectFreeName").attr('uid') || ''
			let coop_pull = $(".selectCoopName").attr('uid') || ''
			let sell_pull = $(".selectSellName").attr('uid') || ''
			let clerk_pull = $(".selectClerkName").attr('uid') || ''
			
			page = page + 1;
			// 发起ajax请求
			getInfoList(name_pull, s_pull, e__pull, sf_pull, yztype_pull, yz_pull, coop_pull,sell_pull,clerk_pull)
			
		}
	});
	
	
	// 展开/收起过滤条件
	var open = false;
	$(".filterBox").click(() => {
		open = !open;
		if (open == true) {
			$(".nextImg").attr("src", "../../../img/down.png");
			$(".filterParamBg").css("display", "block");
		} else {
			$(".nextImg").attr("src", "../../../img/next.png");
			$(".filterParamBg").css("display", "none");
		}
	});

	// 点击空白收起过滤条件
	$(".noneParamBg").click(() => {
		$(".filterParamBg").css("display", "none");
		$(".nextImg").attr("src", "../../../img/next.png");
		open = !open;
	});

	// 点击搜索时发起请求
	$(".search").click(() => {
		page = 1
		let name = $(".searchCont").val()
		getInfoList(name)
	})
	// 点击搜索旁边的叉号 清空搜索条件
	$(".toEmpty").click(() => {
		$(".searchCont").val('')
		getInfoList()
	})
	
	// 当点击搜索框的时候，把筛选条件框 收起来
	$(".searchBox").click(() => {
		$(".nextImg").attr("src", "../../../img/next.png");
		$(".filterParamBg").css("display", "none");
		open = !open;
	});


	// 选择筛选的日期
	$("#startTime").on("click", starTimeLen);
	$("#endTime").on("click", endTimeLen);
	var year = new Date().getFullYear();
	var month = new Date().getMonth() + 1;
	var nowdate = new Date().getDate();
	// 默认时间为当前月份
	$("#startDate").text(year + "-" + format(month));
	$("#endDate").text(year + "-" + format(month));

	// 格式化时间
	function format(num) {
		if (num < 10) {
			return "0" + num;
		} else {
			return num
		}
	}

	// 服务周期开始时间
	function starTimeLen() {
		var dtPicker = new mui.DtPicker({
			type: 'date',
			beginDate: new Date(year-1, 0),
			endDate: new Date(year, month - 1)
		});
		/*  type参数：'datetime'-完整日期视图(年月日时分)
						'date'--年视图(年月日)
						'time' --时间视图(时分)
						'month'--月视图(年月)
						'hour'--时视图(年月日时)
		*/
		dtPicker.show(function(selectItems) {
			var y = selectItems.y.text; //获取选择的年
			var m = selectItems.m.text; //获取选择的月
			var d = selectItems.d.text; //获取选择的日
			var date = y + "-" + m;
			$("#startDate").text(date);
		})
	}

	// 服务周期结束时间
	function endTimeLen() {
		var dtPicker = new mui.DtPicker({
			type: 'date',
			beginDate: new Date(year-1, 0),
			endDate: new Date(year, month - 1)
		});

		dtPicker.show(function(selectItems) {
			var y = selectItems.y.text; //获取选择的年
			var m = selectItems.m.text; //获取选择的月
			var d = selectItems.d.text; //获取选择的日
			var date = y + "-" + m;
			$("#endDate").text(date);
		});
	}


	// 重置筛选条件
	$(".reset").click(() => {
		year = new Date().getFullYear();
		month = new Date().getMonth() + 1;
		// 清空文字
		$(".selectFreeTypeLi").text("全部")
		$(".selectComName").text("");
		$(".selectFreeName").text("");
		$(".selectCoopName").text("")
		$(".selectSellName").text("")
		$(".selectClerkName").text("")
		// 清空uid
		$(".selectFreeTypeLi").attr("uid","2")
		$(".selectComName").attr("uid","")
		$(".selectFreeName").attr("uid","")
		$(".selectCoopName").attr("uid","")
		$(".selectSellName").attr("uid","")
		$(".selectClerkName").attr("uid","")
		
		$("#startDate").text(year + "-" + format(month));
		$("#endDate").text(year + "-" + format(month));
	});

	// 点击确定
	$(".ok").click(() => {
		page = 1
		//  获取开始结束时间
		let s = $("#startDate").text()
		let e = $("#endDate").text()
		// 获取各个角色, 人的uid
		let sf = $(".selectComName").attr('uid') || ''
		let yztype = $(".selectFreeTypeLi").attr('uid') || ''
		let yz = $(".selectFreeName").attr('uid') || ''
		let coop = $(".selectCoopName").attr('uid') || ''
		let sell = $(".selectSellName").attr('uid') || ''
		let clerk = $(".selectClerkName").attr('uid') || ''
		
		let start = s.replace('-','')   // 用于条件判断时间先后
		let end = e.replace('-','')   // 用于条件判断时间先后
		if(start <= end){
			// 清空搜索框
			$(".searchCont").val('')
			// 发起ajax请求
			getInfoList('',s,e,sf,yztype,yz,coop,sell,clerk)
			// 隐藏筛选框
			$(".filterParamBg").css("display", "none");
			$(".nextImg").attr("src", "../../../img/next.png");
			open = !open;
		}
		else {
			mui.toast('开始时间要小于结束时间!',{ duration:'4000', type:'div' })
		}
	})

	// 跳转详情页面
	$(document).on("click", ".list .href", function(e) {
		var detailId = $(this).attr("detailId");
		// console.log(detailId)
		sessionStorage.setItem('detailId', detailId);
		// page.chooseType();
		location.href = "./incomeManaDetail.html";
	});
	
	
	// ================================================================
	
	let freeTypeArr =[   // 该数组存放 业者类型  2 全部,0 有单位,  1 无单位
		{"value":2,"text":"全部"},
		{"value":0,"text":"有单位"},
		{"value":1,"text":"无单位"},
		] 
	
	let comArr = [];   // 该数组存放请求回来的 所有单位
	$.get(urlDns + "/control_app/ms/fr_zg/zf/get_sfData", {
		pass_app: pass_app,
		tel_app: tel_app,
		code_app: code_app
	}, function(data) {
		// console.log(JSON.stringify(data));
		if (data.result == 0) {
			// 需要重新登录
			if (window.plus) {
				goToLogin("../../../page/register/login.html");
			} else {
				document.addEventListener('plusready', goToLogin, false);
			}
		} 
		else {
			for (let i = 0; i < data.rows.length; i++) {
				comArr.push({
					"value": data.rows[i].id,
					"text": data.rows[i].name
				});
			}
			// console.log(JSON.stringify(comArr))
		}
	});

	let freeArr   // 该数组存放请求回来的 所有业者
	getFreeArr()
	function getFreeArr(id=0,islr=2) {
		freeArr = []
		// console.log("执行了获得业者列表的函数:"+ uid)
		$.get(urlDns + "/control_app/ms/fr_zg/zf/get_yzData", {
			pass_app: pass_app,
			tel_app: tel_app,
			code_app: code_app,
			sfid: id,
			islr
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} 
			else {
				for (let i = 0; i < data.rows.length; i++) {
					freeArr.push({
						"value": data.rows[i].id,
						"text": data.rows[i].name
					});
				}
				// console.log(JSON.stringify(freeArr))
			}
		});
	}
	
	let coopArr   // 该数组存放请求回来的 合作伙伴
	getCoopArr()
	function getCoopArr() {
		coopArr = []
		$.get(urlDns + "/control_app/ms/fr_zg/zf/get_hhrData", {
			pass_app: pass_app,
			tel_app: tel_app,
			code_app: code_app
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} 
			else {
				for (let i = 0; i < data.rows.length; i++) {
					coopArr.push({
						"value": data.rows[i].id,
						"text": data.rows[i].name
					});
				}
				// console.log(JSON.stringify(coopArr))
			}
		});
	}
	
	let sellArr   // 该数组存放请求回来的 营销员
	getSellArr()
	function getSellArr() {
		sellArr = []
		$.get(urlDns + "/control_app/ms/fr_zg/zf/get_yxyData", {
			pass_app: pass_app,
			tel_app: tel_app,
			code_app: code_app
		}, function(data) {
			// console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} 
			else {
				for (let i = 0; i < data.rows.length; i++) {
					sellArr.push({
						"value": data.rows[i].id,
						"text": data.rows[i].name
					});
				}
				// console.log(JSON.stringify(sellArr))
			}
		});
	}
	
	let clerkArr   // 该数组存放请求回来的 业务员
	getClerkArr()
	function getClerkArr() {
		clerkArr = []
		$.get(urlDns + "/control_app/ms/fr_zg/zf/get_ywyData", {
			pass_app: pass_app,
			tel_app: tel_app,
			code_app: code_app
		}, function(data) {
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} 
			else {
				for (let i = 0; i < data.rows.length; i++) {
					clerkArr.push({
						"value": data.rows[i].id,
						"text": data.rows[i].name
					});
				}
				// console.log(JSON.stringify(clerkArr))
			}
		});
	}
	
	
	
	// 点击 业者类型
	$(".selectFreeType").on("click", selectFreeType);
	
	function selectFreeType() {
		var popPicker = new mui.PopPicker();
		popPicker.setData(freeTypeArr)
		popPicker.show(function(selectItems) {
			$(".selectFreeTypeLi").text(selectItems[0].text);
			$(".selectFreeTypeLi").attr("uid", selectItems[0].value);
			
			let fType = $(".selectFreeTypeLi").attr("uid")
			if(fType==2) {
				// $(".selectFree").css("display","none")
				$(".selectCom").css("display","none")
				getFreeArr(0,2)
			}
			else if(fType==1) {
				// $(".selectFree").css("display","flex")
				$(".selectCom").css("display","none")
				getFreeArr(0,1)
			}
			else {
				// $(".selectFree").css("display","none")
				$(".selectCom").css("display","flex")
				getFreeArr(0,0)
			}
		})
	}
	
	// 点击 接受服务单位
	$(".selectCom").on("click", selectCom);
	
	function selectCom() {
		var popPicker = new mui.PopPicker();
		popPicker.setData(comArr)

		popPicker.show(function(selectItems) {
			$(".selectComName").text(selectItems[0].text);
			$(".selectComName").attr("uid", selectItems[0].value);
			getFreeArr($(".selectComName").attr("uid"),0)
		})
	}
	
	// 点击 业者姓名
	$(".selectFree").on("click", selectFree);
	
	function selectFree() {
		var popPicker = new mui.PopPicker();
		popPicker.setData(freeArr)

		popPicker.show(function(selectItems) {
			$(".selectFreeName").text(selectItems[0].text);
			$(".selectFreeName").attr("uid", selectItems[0].value);
		})
	}
	
	// 点击 合作伙伴姓名
	$(".selectCoop").on("click", selectCoop);
	
	function selectCoop() {
		var popPicker = new mui.PopPicker();
		popPicker.setData(coopArr)

		popPicker.show(function(selectItems) {
			$(".selectCoopName").text(selectItems[0].text);
			$(".selectCoopName").attr("uid", selectItems[0].value);
		})
	}
	
	// 点击 营销员姓名
	$(".selectSell").on("click", selectSell);
	
	function selectSell() {
		var popPicker = new mui.PopPicker();
		popPicker.setData(sellArr)

		popPicker.show(function(selectItems) {
			$(".selectSellName").text(selectItems[0].text);
			$(".selectSellName").attr("uid", selectItems[0].value);
		})
	}
	
	// 点击 业务员姓名
	$(".selectClerk").on("click", selectClerk);
	
	function selectClerk() {
		var popPicker = new mui.PopPicker();
		popPicker.setData(clerkArr)

		popPicker.show(function(selectItems) {
			$(".selectClerkName").text(selectItems[0].text);
			$(".selectClerkName").attr("uid", selectItems[0].value);
		})
	}
	
	//===============================
	// 点击选择按钮
	let flag = false;
	$(".select-btn").click(() => {
	    flag = !flag;
	    if (flag == true) {
				// 隐藏筛选框
				$(".filterParamBg").css("display", "none");
				$(".nextImg").attr("src", "../../../img/next.png");
				open = !open;
				
				$(".select-btn").text("取消选择");
				$(".back").css("display", "none");
				$("footer").css("display","flex");
				$(".filterBox").css("display","none")
				$(".searchBox").css("display", "none");
				$(".select").css("display", "block");
				$(".select_all").css("display", "block");
				$(".comName").css("left", "20px");
				$(".list").css("margin-top","66px")
	    } 
			else {
				$(".select-btn").text("选择");
				$(".back").css("display", "block");
				$("footer").css("display","none");
				$(".filterBox").css("display","block")
				$(".searchBox").css("display", "block");
				$(".select").css("display", "none");
				$(".select_all").css("display", "none");
				$(".comName").css("left", "0px");
				$(".list").css("margin-top","152px");
				
				$(":checkbox[name='hh']").prop("checked", false);
	    }
	});
	// 全选按钮
	let is_select_all = false
	$(".select_all").click(() => {
		is_select_all = !is_select_all
		if(is_select_all) $(":checkbox[name='hh']").prop("checked", "checked");
		else $(":checkbox[name='hh']").prop("checked", false);
	});
	
	// 点击 "支付"" 请求支付详情页=======================================================
	let ids = ''   // 用于保存返回来的ids
	$(".footer-item").click(() => {
		let check = $(":checkbox[name='hh']:checked")   // 获取所有被选中的 复选框 dom的集合
		let checkArr = Array.from(check)   // 将dom集合转换成数组
		let ids2 = ''   // 定义一个空字符串用于接收id的集合
		
		checkArr.forEach((item,i) => {
			// 获取到 被选中的detailId,,, 这里先要将item转换成jq的对象$()
			if(i == 0) ids2 = ids2 + $(item).next().children("div").attr('detailId')
			else ids2 = ids2  + ',' + $(item).next().children("div").attr('detailId')
		})
		
		if(ids2.length == 0){
			mui.toast('选中的条目不能为空!',{ duration:'4000', type:'div' })
		}
		else{
			// 请求支付详情的数据
				mui.post(urlDns + "/control_app/ms/fr_zg/zf_pay/payUI", {
					pass_app: pass_app,
					tel_app: tel_app,
					code_app: code_app,
					ids2: ids2
				}, function(data) {
					// console.log(JSON.stringify(data));
					if (data.result == 0) {
						// 需要重新登录
						if (window.plus) {
							goToLogin("../../../page/register/login.html");
						} else {
							document.addEventListener('plusready', goToLogin, false);
						}
					} else {
						ids = data.ids // 保存ids
						// 弹出提示框
						$(".dialog-container").css("display","flex")
						$(".dialog-money span").text(data.allmoney)
					}
				});
		}
	})
	
	
	
	// 获取验证码=============================================================
	let msm   // 定义一个变量接收 验证码
	let time = 60   // 定义一个计时器变量
	$(".get-code").on("click", get_code);   // 点击 "获取验证码"
	
	function get_code() {
		let tel = $("#input-tel").val() // 定义一个变量接收手机号
		console.log("点击了  获取")
		time = 59
		if (tel == "") {
			mui.toast('请输入手机号!',{ duration:'4000', type:'div' })
		} else {
			$(".get-code").off("click");
			// 向后台发请求获取验证码
			$.post(urlDns + "/getMsm_app2", {
				tel: tel,
				pass_app: pass_app,
				tel_app: tel_app,
				code_app: code_app
				}, function(data) {
				console.log("验证码 请求响应了")
				console.log(JSON.stringify(data));
				if (data.result == 0) {
					// 需要重新登录
					if (window.plus) {
						goToLogin("../../../page/register/login.html");
					} else {
						document.addEventListener('plusready', goToLogin, false);
					}
					mui.toast(data.message,{ duration:'4000', type:'div' })
					$(".get-code").text("获取验证码");
					$(".get-code").css("color", "#7EB6FF");
					$(".get-code").on("click", get_code);
				} 
				else {
					// 倒计时
					$(".get-code").text(time + "秒");
					$(".get-code").css("color", "gray");
					var t = setInterval(() => {
						time = time - 1;
						$(".get-code").text(time + "秒");
						if (time < 1) {
							clearInterval(t);
							$(".get-code").text("重新获取");
							$(".get-code").css("color", "#7EB6FF");
							$(".get-code").on("click", get_code);
						}
					}, 1000);
					msm = data.msm
				}
			});
		}
	}
	
	//发起最终支付的请求============================================================
	$(".cancel").click(() => {   // 点击了 取消支付
		$(".dialog-container").css("display","none")
	})
	
	$(".success").click(() => {   // 点击了确认支付
		let tel = $("#input-tel").val()   // 定义一个变量接收手机号
		let telcode = $("#input-code").val()   // 定义一个变量 获取 输入的验证码
		if (tel == "") {
			mui.toast('请输入手机号!',{ duration:'4000', type:'div' })
		}
		else if (telcode == undefined){
			mui.toast('验证码不能为空!',{ duration:'4000', type:'div' })
		}
		else if(telcode != msm) {
			console.log("验证码  不正确")
			mui.toast('验证码不正确!',{ duration:'4000', type:'div' })
		}
		else {
			// 发起 最终支付 请求
			$.post(urlDns + "/control_app/ms/fr_zg/zf_pay/pay", {
				ids: ids,
				telcode: telcode,
				validateCode: msm,
				pass_app: pass_app,
				tel_app: tel_app,
				code_app: code_app
				}, function(data) {
					console.log(JSON.stringify(data));
					if (data.result == 0) {
						// 需要重新登录
						if (window.plus) {
							goToLogin("../../../page/register/login.html");
						} else {
							document.addEventListener('plusready', goToLogin, false);
						}
					} 
					else {
						$(".dialog-container").css("display","none")
						// 弹出支付成功的提示框
						mui.toast('支付成功!',{ duration:'5000', type:'div' })
						
						// 回到页面的上一个状态
						$(".select-btn").text("选择");
						$(".back").css("display", "block");
						$("footer").css("display","none");
						$(".filterBox").css("display","block")
						$(".searchBox").css("display", "block");
						$(".select").css("display", "none");
						$(".select_all").css("display", "none");
						$(".comName").css("left", "0px");
						$(".list").css("margin-top","152px");
					}
				});
		}
	})
</script>
</html>
