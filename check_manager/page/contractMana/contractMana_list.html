<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<script src="../../../js/mui.min.js"></script>
	<link rel="stylesheet" href="../../../css/mui.min.css">
	<link rel="stylesheet" href="../../../css/mui.picker.min.css">
	<script src="../../../js/mui.picker.min.js"></script>
	<title>审核主管--协议管理--列表页</title>

	<style type="text/css">
		body {
			margin: 0;
			padding: 0;
			color: #333333;
		}

		header {
			box-sizing: border-box;
			position: fixed;
			top: 0;
			left: 0;
			z-index: 99;
			text-align: center;
			line-height: 44px;
			width: 100%;
			height: 44px;
			background-color: white;
			box-shadow: 0 2px 2px 0 rgba(231, 231, 231, 1);
		}

		header>img {
			position: absolute;
			top: 12px;
			left: 5px;
			width: 20px;
			height: 20px;
		}

		header>div {
			position: absolute;
			top: 0;
			right: 5px;
			height: 44px;
			line-height: 44px;
		}

		header>div>span {
			color: #999999;
		}

		.next {
			line-height: 44px;
			color: #7EB6FF;
			margin-right: 10px;
		}

		.list {
			margin-top: 60px;
			margin-bottom: 20px;
		}

		.list>div {
			background-color: #FFF;
			position: relative;
			width: 100%;
			margin-top:2px;
		}

		.list>div:nth-of-type(1) {
			margin-top: 20px;
		}

		.list>div>div {
			width: 100%;
			height: 40px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-bottom: 1px solid rgb(240, 240, 240);
			font-size: 14px;
			padding: 0 5px 0 15px;
		}

		.list>div img {
			width: 25px;
			height: 25px;
			vertical-align: middle;
		}
		
		.mybadge {display: none;}

		.time {
			color: #999999;
		}

		.amount {
			height: 30px;
			line-height: 30px;
			font-size: 12px;
			color: #999999;
			padding: 0 15px 0 15px;
		}

		.searchBox {
			/* display: none; */
			
			position: fixed;
			top: 44px;
			left: 0;
			z-index: 99;
			width: 100%;
			height: 44px;
			padding: 7px 0 7px 15px;
			background-color: #F2F2F2;
		}

		.searchIn {
			position: relative;
			width: calc(100% - 60px);
			height: 30px;
			background-color: white;
			border-radius: 3px;
			box-sizing: border-box;
		}

		.searchIn>input {
			position: absolute;
			top: 0;
			left: 25px;
			padding: 0;
			width: 80%;
			height: 30px;
			font-size: 14px;
			text-align: left;
			background-color: white;
		}

		.searchIn>input::placeholder {
			font-size: 12px;
		}

		.searchImg {
			position: absolute;
			top: 7.5px;
			left: 5px;
			width: 15px;
			height: 15px;
		}

		.toEmpty {
			position: absolute;
			top: 7.5px;
			right: 10px;
			width: 15px;
			height: 15px;
		}

		.search {
			position: absolute;
			top: 0;
			right: 15px;
			line-height: 44px;
			font-size: 14px;
			color: #7EB6FF;
		}

		footer {
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 50px;
			background-color: white;
			font-size: 12px;
		}

		.del,
		.submit {
			position: absolute;
			top: 0;
			width: calc((100% - 45px)/2);
			height: 40px;
			margin-top: 5px;
			border-radius: 4px;
		}

		.del div:nth-of-type(1),
		.submit div:nth-of-type(1) {
			font-weight: bold;
		}

		.del div:nth-of-type(2),
		.submit div:nth-of-type(2) {
			color: #999999;
		}

		.del {
			left: 0;
			margin-left: 15px;
			text-align: left;
		}

		.submit {
			right: 0;
			margin-right: 15px;
			text-align: right;
		}

		.select {
			display: none;
			position: absolute;
			top: 11px;
			left: 10px;
		}

		.filterBox {
			position: fixed;
			top: 88px;
			left: 0;
			z-index: 99;
			/* display: none; */
			width: 100%;
			height: 44px;
			color: rgb(153, 153, 153);
			background-color: white;
			padding: 0 5px 0 15px;
			font-size: 14px;
			line-height: 44px;
			border-bottom: 1px solid rgb(240, 240, 240);
		}

		.nextImg {
			position: absolute;
			top: 8px;
			right: 5px;
			width: 25px;
			height: 25px;
		}

		.filterImg {
			position: relative;
			top: 2px;
			width: 15px;
			height: 15px;
		}

		.filterParam {
			background-color: white;
		}

		.selectTime {
			padding: 0 15px;
			display: flex;
			justify-content: space-between;
			width: 100%;
			height: 44px;
			background-color: white;
			border-bottom: 1px solid rgb(240, 240, 240);
			line-height: 44px;
			font-size: 14px;
		}

		.timeBox {
			width: 75%;
			display: flex;
			justify-content: space-between;
		}

		#startTime,
		#endTime {
			display: flex;
			justify-content: space-around;
			/* position: relative; */
			width: 40%;
			height: 30px;
			border: 1px solid rgb(204, 204, 204);
			border-radius: 4px;
			margin-top: 8px;
		}

		#startTime>img,
		#endTime>img {
			width: 16px;
			height: 16px;
			margin-top: 5px;
		}

		#startTime>span,
		#endTime>span {
			font-size: 13px;
			line-height: 30px;
		}

		#startDate,
		#endDate {
			color: #666666;
		}

		.free-com {
			width: 92%;
			margin: 0 auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
			height: 44px;
			border-bottom: 1px solid rgb(240, 240, 240);
		}

		.free-com>div {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.free-com span {
			font-size: 14px;
		}

		.free-com img {
			width: 25px;
			height: 25px;
			/* vertical-align: center; */
		}

		.okBox {
			position: relative;
			width: 100%;
			height: 44px;
		}

		.okBox div {
			top: 8px;
			position: absolute;
			width: calc((100% - 45px)/2);
			height: 28px;
			border-radius: 4px;
			font-size: 14px;
			text-align: center;
			line-height: 28px;
		}

		.ok {
			right: 15px;
			color: white;
			background-color: #7EB6FF;
		}

		.reset {
			left: 8px;
			color: #7EB6FF;
			border: 1px solid rgb(204, 204, 204);
		}

		.filterParamBg {
			display: none;
			position: absolute;
			background-color: rgba(0, 0, 0, 0.2);
			z-index: 10;
			top: 133px;
			left: 0;
			width: 100%;
			height: calc(100vh - 133px);
		}

		.noneParamBg {
			width: 100%;
			height: calc(100vh - 310px);
			position: absolute;
			bottom: 0;
			left: 0;
		}
	</style>
</head>
<body>
	<header>
		<img class="back" src="../../../img/back_black.png" alt="">
		<span></span>
		<!-- <div class="next">选择</div> -->
	</header>

	<!-- 数据列表 -->
	<section class="list">
		
		
	</section>
	<!-- <footer>
			<div class="del">
					<div>200,000.00</div>
					<div>已开票金额</div>
			</div>
			<div class="submit">
					<div>0.00</div>
					<div>未开票余额</div>
			</div>
	</footer> -->
</body>
<script src="../../../js/jquery-3.3.1.js"></script>
<script src="../../../js/urlDns.js"></script>

<script type="text/javascript">
	
	mui.init({
		beforeback: function() {
			backActive()
			return true
		}
	})
	// 返回=======================
	$(".back").click(() => {
		mui.back();
	});
	// 返回之前要执行的操作 函数
	function backActive() {
		// sessionStorage.removeItem("income_status");
	}

	var pass_app = localStorage.getItem("pass_app");
	var tel_app = localStorage.getItem("tel_app");
	var code_app = localStorage.getItem("code_app");

	// 获取状态码
	var income_status = sessionStorage.getItem("income_status");
	// 渲染标题
	if (income_status == 3) {
		$("header span").text("公司与单位的协议");
	}
	if (income_status == 5) {
		$("header span").text("公司与业者的协议");
	}
	if (income_status == 11) {
		$("header span").text("公司与合作伙伴的协议");
	}
	if (income_status == 4) {
		$("header span").text("三方协议");
	}
	if (income_status == 9) {
		$("header span").text("委托协议上传");
	}
	if (income_status == 2) {
		$("header span").text("单位与业者的协议模板");
	}

	
	var page = 1 // 设置当前 在第几个页面
	
	getInfoList() //调用函数初始化 界面上要展示的数据列表


	function getInfoList() {
		
		console.log("执行了")
		// 请求数据
		mui.post(urlDns + "/control_app/ms/xieyi_fr/list", {
			// 进入的状态
			type: income_status,
			// 第几页
			page: page,
			// 一页的条数
			rows: 20,
			pass_app: pass_app,
			tel_app: tel_app,
			code_app: code_app
		}, function(data) {
			console.log("请求响应了")
			console.log(JSON.stringify(data));
			if (data.result == 0) {
				// 需要重新登录
				if (window.plus) {
					goToLogin("../../../page/register/login.html");
				} else {
					document.addEventListener('plusready', goToLogin, false);
				}
			} else {
				if(page==1){ $(".list").html(''); }   // 发起请求之前,先清空页面
				var htmlStr = "";
				for (let i = 0; i < data.rows.length; i++) {
					htmlStr +=
					`
					<div>
						<div class="comTime">
							<div class="comName">${data.rows[i].addtime} <span class="mybadge mui-badge mui-badge-primary" style= ${data.rows[i].status==1? "display:inline-block":"display:none"}>默认</span> </div>
							<div class="href" detailId="${data.rows[i].id}">
								<span class="time">${data.rows[i].status==1? '查看':'审核'}</span>
								<img src="../../../img/next.png" alt="">
							</div>
						</div>
					</div>
				`;
				}
				$(".list").append(htmlStr);
			}
		});
	}

	// ======================加载下一页===================================================
	$(window).scroll(function() {
		if ($(window).scrollTop() + $(window).height() == $(document).height()) {
			page = page + 1;
			// 发起ajax请求
			getInfoList()
		}
	});

	// 跳转详情页面
	$(document).on("click", ".list .href", function(e) {
		var detailId = $(this).attr("detailId");
		sessionStorage.setItem('detailId', detailId);
		location.href = "./contractMana_detail.html";
	});


</script>
</html>